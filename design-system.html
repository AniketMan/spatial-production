<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Design System ‚Äî Meta Production Tools</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ============================================================
       RESET & BASE
       ============================================================ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', sans-serif;
      background: #0a0a0c;
      color: #f2f3f5;
    }

    /* ============================================================
       LAYOUT: 3-panel ‚Äî sidebar | preview | code
       ============================================================ */
    .app { display: flex; height: 100vh; }

    /* LEFT SIDEBAR ‚Äî Inspector */
    .sidebar {
      width: 320px;
      min-width: 320px;
      background: #111114;
      border-right: 1px solid rgba(255,255,255,0.06);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .sidebar-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-header h2 {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.9);
    }
    .sidebar-scroll {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }
    .sidebar-scroll::-webkit-scrollbar { width: 4px; }
    .sidebar-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }

    .sidebar-empty {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: rgba(255,255,255,0.25);
      font-size: 13px;
      text-align: center;
      padding: 40px;
      line-height: 1.6;
    }

    /* Property group */
    .prop-group {
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .prop-group-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      cursor: pointer;
      user-select: none;
    }
    .prop-group-header:hover { background: rgba(255,255,255,0.02); }
    .prop-group-title {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.5);
    }
    .prop-group-badge {
      font-size: 9px;
      letter-spacing: 1px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    .badge-universal { background: rgba(0,130,251,0.15); color: #0082fb; }
    .badge-instance { background: rgba(52,199,89,0.15); color: #34c759; }
    .prop-group-chevron {
      font-size: 10px;
      color: rgba(255,255,255,0.3);
      transition: transform 0.2s;
    }
    .prop-group.collapsed .prop-group-chevron { transform: rotate(-90deg); }
    .prop-group-body { padding: 0 20px 16px; }
    .prop-group.collapsed .prop-group-body { display: none; }

    /* Individual property row */
    .prop-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .prop-label {
      font-size: 11px;
      color: rgba(255,255,255,0.55);
      min-width: 90px;
      flex-shrink: 0;
    }
    .prop-slider {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 3px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      outline: none;
    }
    .prop-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #0082fb;
      cursor: pointer;
    }
    .prop-number {
      width: 52px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #f2f3f5;
      font-size: 12px;
      font-family: 'SF Mono', monospace;
      text-align: center;
      padding: 4px;
      outline: none;
    }
    .prop-number:focus { border-color: #0082fb; }
    .prop-unit {
      font-size: 10px;
      color: rgba(255,255,255,0.3);
      width: 16px;
    }
    .prop-color {
      width: 28px;
      height: 28px;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 6px;
      cursor: pointer;
      padding: 0;
      background: none;
      -webkit-appearance: none;
    }
    .prop-color::-webkit-color-swatch-wrapper { padding: 2px; }
    .prop-color::-webkit-color-swatch { border: none; border-radius: 4px; }
    .prop-color-label {
      font-size: 11px;
      color: rgba(255,255,255,0.4);
      font-family: 'SF Mono', monospace;
    }
    .prop-text {
      flex: 1;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #f2f3f5;
      font-size: 12px;
      padding: 6px 8px;
      outline: none;
      font-family: inherit;
    }
    .prop-text:focus { border-color: #0082fb; }
    .prop-select {
      flex: 1;
      background: #1a1b1e;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #f2f3f5;
      font-size: 12px;
      padding: 5px 8px;
      outline: none;
    }
    .prop-select option { background: #1a1b1e; color: #f2f3f5; }

    /* ============================================================
       CENTER ‚Äî Preview Area
       ============================================================ */
    .preview-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      background: #111114;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      flex-wrap: wrap;
    }
    .toolbar-group {
      display: flex;
      align-items: center;
      gap: 2px;
      background: rgba(255,255,255,0.04);
      border-radius: 8px;
      padding: 2px;
    }
    .toolbar-btn {
      padding: 6px 14px;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.5);
      font-size: 12px;
      font-weight: 500;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .toolbar-btn.active { background: #0082fb; color: #fff; }
    .toolbar-btn:hover:not(.active) { color: rgba(255,255,255,0.8); }
    .toolbar-label {
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.3);
      margin-right: 4px;
    }
    .page-select {
      background: #1a1b1e;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #f2f3f5;
      font-size: 12px;
      padding: 6px 12px;
      outline: none;
      margin-left: auto;
    }
    .page-select option { background: #1a1b1e; color: #f2f3f5; }
    .save-btn {
      padding: 6px 16px;
      background: #0082fb;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
    }
    .save-btn:hover { background: #006ed4; }

    /* Preview canvas */
    .preview-canvas {
      flex: 1;
      overflow: auto;
      padding: 40px;
      background: #0a0a0c;
      transition: max-width 0.3s;
    }
    .preview-canvas.mobile { max-width: 390px; margin: 0 auto; }

    .preview-section {
      margin-bottom: 48px;
    }
    .preview-section-label {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.25);
      margin-bottom: 16px;
      font-family: 'SF Mono', monospace;
    }

    /* Clickable component wrapper */
    .component-wrap {
      position: relative;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 22px;
      transition: border-color 0.2s;
      padding: 2px;
    }
    .component-wrap:hover { border-color: rgba(0,130,251,0.3); }
    .component-wrap.selected { border-color: #0082fb; }
    .component-wrap .comp-tag {
      position: absolute;
      top: -10px;
      left: 16px;
      font-size: 9px;
      letter-spacing: 1px;
      padding: 2px 8px;
      border-radius: 4px;
      background: #0082fb;
      color: #fff;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 1;
    }
    .component-wrap:hover .comp-tag,
    .component-wrap.selected .comp-tag { opacity: 1; }

    /* ============================================================
       COMPONENT PREVIEW STYLES (mirrors actual site)
       ============================================================ */
    .p-glass {
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(255,255,255,0.04);
      padding: 28px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .p-glass-sm {
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(255,255,255,0.04);
      padding: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .p-section-label {
      font-size: 11px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
      font-family: 'SF Mono', monospace;
      margin-bottom: 12px;
    }
    .p-card-label {
      font-size: 15px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.85);
      font-family: 'SF Mono', monospace;
    }
    .p-hero-badge {
      display: inline-block;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 100px;
      padding: 6px 16px;
      font-size: 12px;
      letter-spacing: 2px;
      color: rgba(255,255,255,0.6);
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.05);
      text-transform: uppercase;
      font-family: 'SF Mono', monospace;
    }
    .p-status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      letter-spacing: 1px;
      font-family: 'SF Mono', monospace;
    }
    .p-status-progress { background: rgba(0,130,251,0.15); color: #0082fb; border: 1px solid rgba(0,130,251,0.3); }
    .p-status-specced { background: rgba(52,199,89,0.15); color: #34c759; border: 1px solid rgba(52,199,89,0.3); }
    .p-status-not-started { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.4); border: 1px solid rgba(255,255,255,0.1); }
    .p-tech-tag {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 11px;
      letter-spacing: 1px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03);
      color: rgba(255,255,255,0.5);
      font-family: 'SF Mono', monospace;
    }
    .p-live-dot {
      display: inline-block;
      width: 6px; height: 6px;
      border-radius: 50%;
      background: #34c759;
      margin-right: 6px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
    .p-live-label {
      font-size: 11px;
      letter-spacing: 2px;
      color: #34c759;
      font-family: 'SF Mono', monospace;
    }
    .p-legend-dot {
      display: inline-block;
      width: 8px; height: 8px;
      border-radius: 50%;
      margin-right: 6px;
    }
    .p-legend-label {
      font-size: 12px;
      color: rgba(255,255,255,0.5);
    }

    /* Asset layer row */
    .p-asset-layer {
      padding: 16px 20px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 8px;
      font-size: 14px;
      letter-spacing: 1px;
      font-family: 'SF Mono', monospace;
      margin-bottom: 6px;
    }

    /* Layer number badge */
    .p-layer-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px; height: 28px;
      border-radius: 50%;
      font-size: 11px;
      font-weight: 600;
      background: rgba(0,130,251,0.1);
      color: #0082fb;
      border: 1px solid rgba(0,130,251,0.2);
      font-family: 'SF Mono', monospace;
      margin-right: 12px;
    }

    /* Comparison table */
    .p-comp-table { width: 100%; border-collapse: collapse; }
    .p-comp-table th {
      font-size: 13px;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-family: 'SF Mono', monospace;
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-weight: 500;
    }
    .p-comp-table td {
      font-size: 14px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.7);
    }

    /* Icon circle */
    .p-icon-circle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 18px;
    }

    /* Non-chrome fallback mode */
    .fallback-mode .p-glass,
    .fallback-mode .p-glass-sm {
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      background: rgba(30,30,35,0.95);
    }

    /* Code editor area */
    .code-section {
      border-top: 1px solid rgba(255,255,255,0.06);
      padding: 12px 20px 16px;
    }
    .code-section-title {
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
      margin-bottom: 8px;
    }
    .code-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 8px;
    }
    .code-tab {
      padding: 4px 10px;
      font-size: 10px;
      letter-spacing: 1px;
      border: none;
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.4);
      border-radius: 4px;
      cursor: pointer;
    }
    .code-tab.active { background: rgba(0,130,251,0.2); color: #0082fb; }
    .code-editor {
      width: 100%;
      min-height: 120px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px;
      color: #a8d8a8;
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-size: 11px;
      line-height: 1.5;
      padding: 12px;
      resize: vertical;
      outline: none;
      tab-size: 2;
    }
    .code-editor:focus { border-color: rgba(0,130,251,0.4); }
  </style>
</head>
<body>
  <div class="app">
    <!-- ============================================================
         LEFT SIDEBAR ‚Äî Inspector
         ============================================================ -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>Inspector</h2>
        <span id="close-btn" style="cursor:pointer;color:rgba(255,255,255,0.3);font-size:18px;display:none;">&times;</span>
      </div>
      <div class="sidebar-scroll" id="sidebar-content">
        <div class="sidebar-empty" id="empty-state">
          Click any component<br>in the preview to inspect<br>and edit its properties
        </div>
        <!-- Panels are injected dynamically by JS -->
      </div>
    </div>

    <!-- ============================================================
         CENTER ‚Äî Preview
         ============================================================ -->
    <div class="preview-area">
      <!-- Toolbar -->
      <div class="toolbar">
        <span class="toolbar-label">Browser</span>
        <div class="toolbar-group">
          <button class="toolbar-btn active" data-mode="chrome" onclick="setBrowser('chrome')">Chrome</button>
          <button class="toolbar-btn" data-mode="fallback" onclick="setBrowser('fallback')">Non-Chrome</button>
        </div>
        <span class="toolbar-label">Viewport</span>
        <div class="toolbar-group">
          <button class="toolbar-btn active" data-vp="desktop" onclick="setViewport('desktop')">Desktop</button>
          <button class="toolbar-btn" data-vp="mobile" onclick="setViewport('mobile')">Mobile</button>
        </div>
        <span class="toolbar-label">Page</span>
        <select class="page-select" id="page-select" onchange="setPage(this.value)">
          <option value="universal">Universal</option>
          <option value="home">Home</option>
          <option value="spatial">Meta</option>
          <option value="compound">Compound Assets</option>
          <option value="world">World Building</option>
        </select>
        <button class="save-btn" onclick="exportConfig()">Save &amp; Export</button>
      </div>

      <!-- Preview Canvas -->
      <div class="preview-canvas" id="preview-canvas">

        <!-- ==================== UNIVERSAL COMPONENTS ==================== -->
        <div id="page-universal">

          <!-- COLOR PALETTE -->
          <div class="preview-section">
            <div class="preview-section-label">Color Palette</div>
            <div class="component-wrap" data-comp="colors" onclick="selectComp(this)">
              <span class="comp-tag">COLORS</span>
              <div style="display:flex;gap:12px;flex-wrap:wrap;" id="color-swatches">
                <div style="width:60px;height:60px;border-radius:12px;background:#0082fb;" data-color="accent-blue" title="Meta Blue"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:#34c759;" data-color="accent-green" title="Green"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:#00d4aa;" data-color="accent-cyan" title="Cyan"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:#ff3b30;" data-color="accent-red" title="Red"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:#ff9f0a;" data-color="accent-orange" title="Orange"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:#bf5af2;" data-color="accent-purple" title="Purple"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:rgba(255,255,255,0.95);border:1px solid rgba(255,255,255,0.1);" data-color="text-primary" title="Text Primary"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:rgba(255,255,255,0.6);" data-color="text-secondary" title="Text Secondary"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:rgba(255,255,255,0.35);" data-color="text-tertiary" title="Text Tertiary"></div>
                <div style="width:60px;height:60px;border-radius:12px;background:#0a0a0c;border:1px solid rgba(255,255,255,0.1);" data-color="bg-primary" title="BG Primary"></div>
              </div>
            </div>
          </div>

          <!-- TYPOGRAPHY -->
          <div class="preview-section">
            <div class="preview-section-label">Typography</div>
            <div class="component-wrap" data-comp="typography" onclick="selectComp(this)">
              <span class="comp-tag">TYPOGRAPHY</span>
              <div style="padding:24px;">
                <div id="typo-h1" style="font-size:72px;font-weight:700;letter-spacing:-2px;margin-bottom:16px;color:rgba(255,255,255,0.95);">Hero Title</div>
                <div id="typo-h2" style="font-size:56px;font-weight:600;letter-spacing:-1px;margin-bottom:16px;color:rgba(255,255,255,0.95);">Section Title</div>
                <div id="typo-body" style="font-size:18px;line-height:1.7;color:rgba(255,255,255,0.6);margin-bottom:16px;">Body text ‚Äî A modular, portable virtual production pipeline built on Meta hardware and Unreal Engine 5.7.</div>
                <div id="typo-label" style="font-size:11px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,0.35);font-family:'SF Mono',monospace;margin-bottom:8px;">SECTION LABEL</div>
                <div id="typo-card-label" style="font-size:15px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.85);font-family:'SF Mono',monospace;">CARD PANEL LABEL</div>
              </div>
            </div>
          </div>

          <!-- GLASS CONTAINER -->
          <div class="preview-section">
            <div class="preview-section-label">Glass Container</div>
            <div style="display:flex;gap:20px;flex-wrap:wrap;">
              <div class="component-wrap" data-comp="glass" onclick="selectComp(this)" style="flex:1;min-width:280px;">
                <span class="comp-tag">GLASS DEFAULT</span>
                <div class="p-glass" id="preview-glass">
                  <div class="p-card-label" style="margin-bottom:12px;">Glass Container</div>
                  <div style="font-size:14px;color:rgba(255,255,255,0.6);line-height:1.6;">Default size with 28px padding, 20px border-radius, and backdrop blur.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="glass-sm" onclick="selectComp(this)" style="flex:1;min-width:220px;">
                <span class="comp-tag">GLASS SM</span>
                <div class="p-glass-sm" id="preview-glass-sm">
                  <div class="p-card-label" style="margin-bottom:8px;">Glass SM</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.6);">Smaller variant, 20px padding.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- BADGES & TAGS -->
          <div class="preview-section">
            <div class="preview-section-label">Badges &amp; Tags</div>
            <div class="component-wrap" data-comp="badges" onclick="selectComp(this)">
              <span class="comp-tag">BADGES</span>
              <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;padding:16px;">
                <span class="p-hero-badge" id="preview-hero-badge">PIPELINE ARCHITECTURE</span>
                <span class="p-status-badge p-status-progress" id="preview-status-progress">In Progress</span>
                <span class="p-status-badge p-status-specced" id="preview-status-specced">Specced</span>
                <span class="p-status-badge p-status-not-started" id="preview-status-not-started">Not Started</span>
                <span class="p-tech-tag" id="preview-tech-tag">Unreal Engine 5.7</span>
              </div>
            </div>
          </div>

          <!-- LEGEND & LIVE INDICATOR -->
          <div class="preview-section">
            <div class="preview-section-label">Legend &amp; Live Indicator</div>
            <div class="component-wrap" data-comp="legend" onclick="selectComp(this)">
              <span class="comp-tag">LEGEND</span>
              <div style="display:flex;gap:24px;align-items:center;padding:16px;">
                <span><span class="p-live-dot"></span><span class="p-live-label" id="preview-live">LIVE</span></span>
                <span><span class="p-legend-dot" style="background:#0082fb;"></span><span class="p-legend-label">VRProduction</span></span>
                <span><span class="p-legend-dot" style="background:#34c759;"></span><span class="p-legend-label">WorldEngine</span></span>
                <span><span class="p-legend-dot" style="background:#bf5af2;"></span><span class="p-legend-label">DepthComposite</span></span>
              </div>
            </div>
          </div>

          <!-- ICON CIRCLES -->
          <div class="preview-section">
            <div class="preview-section-label">Icon Circles</div>
            <div class="component-wrap" data-comp="icon-circles" onclick="selectComp(this)">
              <span class="comp-tag">ICON CIRCLES</span>
              <div style="display:flex;gap:16px;align-items:center;padding:16px;">
                <div class="p-icon-circle" style="width:48px;height:48px;background:rgba(0,130,251,0.15);font-size:20px;">‚àû</div>
                <div class="p-icon-circle" style="width:48px;height:48px;background:rgba(52,199,89,0.15);font-size:20px;">‚óÜ</div>
                <div class="p-icon-circle" style="width:48px;height:48px;background:rgba(0,212,170,0.15);font-size:20px;">‚óé</div>
                <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(255,59,48,0.15);font-size:16px;">‚è∫</div>
                <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(0,130,251,0.15);font-size:16px;">üë§</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== HOME PAGE ==================== -->
        <div id="page-home" style="display:none;">
          <div class="preview-section">
            <div class="preview-section-label">Hero Section</div>
            <div class="component-wrap" data-comp="home-hero" onclick="selectComp(this)">
              <span class="comp-tag">HOME HERO</span>
              <div id="preview-home-hero" style="display:flex;align-items:center;justify-content:center;text-align:center;padding:60px 40px;min-height:280px;">
                <div>
                  <div class="p-hero-badge" style="font-size:clamp(2rem,5vw,3.5rem);padding:0.6rem 2rem;font-weight:700;margin-bottom:24px;">Home</div>
                  <div style="font-size:18px;line-height:1.7;color:rgba(255,255,255,0.6);max-width:640px;margin:0 auto;">A modular, portable virtual production pipeline built on Meta hardware and Unreal Engine 5.7. Two decoupled modules ‚Äî WorldEngine and VRProduction ‚Äî scale from a single workstation to full studio clusters.</div>
                  <div style="margin-top:20px;font-size:13px;color:rgba(255,255,255,0.35);display:flex;gap:8px;justify-content:center;align-items:center;">
                    <span>By Aniket Bhatt</span>
                    <span>&middot;</span>
                    <span>Unreal Engine 5.7</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Pillar Cards</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;">
              <div class="component-wrap" data-comp="home-pillar-spatial" onclick="selectComp(this)">
                <span class="comp-tag">PILLAR: SPATIAL</span>
                <div class="p-glass" id="preview-pillar-spatial">
                  <div class="p-icon-circle" style="width:48px;height:48px;background:rgba(255,255,255,0.04);border-radius:14px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="4" y="8" width="24" height="16" rx="4" stroke="currentColor" stroke-width="1.5"/><circle cx="12" cy="16" r="4" stroke="currentColor" stroke-width="1"/><circle cx="20" cy="16" r="4" stroke="currentColor" stroke-width="1"/></svg>
                  </div>
                  <div style="font-size:20px;font-weight:600;letter-spacing:-0.02em;margin-bottom:12px;">Meta Production Tools</div>
                  <div style="font-size:15px;color:rgba(255,255,255,0.55);line-height:1.6;">A project-agnostic, portable filmmaking toolkit designed as a self-contained UE5 plugin.</div>
                  <div style="display:flex;align-items:center;gap:6px;margin-top:20px;font-size:13px;font-weight:500;color:#0082fb;">
                    <span>Learn more</span>
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 3L9 7L5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </div>
                </div>
              </div>
              <div class="component-wrap" data-comp="home-pillar-assets" onclick="selectComp(this)">
                <span class="comp-tag">PILLAR: ASSETS</span>
                <div class="p-glass" id="preview-pillar-assets">
                  <div class="p-icon-circle" style="width:48px;height:48px;background:rgba(255,255,255,0.04);border-radius:14px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="6" y="4" width="20" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="6" y="13" width="20" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="6" y="22" width="20" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/></svg>
                  </div>
                  <div style="font-size:20px;font-weight:600;letter-spacing:-0.02em;margin-bottom:12px;">Compound Asset Pipeline</div>
                  <div style="font-size:15px;color:rgba(255,255,255,0.55);line-height:1.6;">Assets are layered, interconnected structures. Build once, compound everywhere.</div>
                  <div style="display:flex;align-items:center;gap:6px;margin-top:20px;font-size:13px;font-weight:500;color:#0082fb;">
                    <span>Learn more</span>
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 3L9 7L5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </div>
                </div>
              </div>
              <div class="component-wrap" data-comp="home-pillar-world" onclick="selectComp(this)">
                <span class="comp-tag">PILLAR: WORLD</span>
                <div class="p-glass" id="preview-pillar-world">
                  <div class="p-icon-circle" style="width:48px;height:48px;background:rgba(255,255,255,0.04);border-radius:14px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><circle cx="16" cy="8" r="3" stroke="currentColor" stroke-width="1.5"/><circle cx="8" cy="22" r="3" stroke="currentColor" stroke-width="1.5"/><circle cx="24" cy="22" r="3" stroke="currentColor" stroke-width="1.5"/><line x1="14" y1="10.5" x2="9.5" y2="19.5" stroke="currentColor" stroke-width="1"/><line x1="18" y1="10.5" x2="22.5" y2="19.5" stroke="currentColor" stroke-width="1"/><line x1="11" y1="22" x2="21" y2="22" stroke="currentColor" stroke-width="1"/></svg>
                  </div>
                  <div style="font-size:20px;font-weight:600;letter-spacing:-0.02em;margin-bottom:12px;">World Building Neural Network</div>
                  <div style="font-size:15px;color:rgba(255,255,255,0.55);line-height:1.6;">A project-specific simulation layer modeling the world as a coherent mechanistic system.</div>
                  <div style="display:flex;align-items:center;gap:6px;margin-top:20px;font-size:13px;font-weight:500;color:#0082fb;">
                    <span>Learn more</span>
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 3L9 7L5 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Footer</div>
            <div class="component-wrap" data-comp="home-footer" onclick="selectComp(this)">
              <span class="comp-tag">FOOTER</span>
              <div id="preview-home-footer" style="padding:24px 0;border-top:1px solid rgba(255,255,255,0.08);text-align:center;">
                <div style="font-size:14px;color:rgba(255,255,255,0.55);margin-bottom:8px;">Designed and engineered by <strong style="font-weight:500;color:rgba(255,255,255,0.95);">Aniket Bhatt</strong></div>
                <div style="font-size:13px;color:rgba(255,255,255,0.25);margin-bottom:16px;">Meta Creative Core &middot; Production Design + XR</div>
                <div style="display:flex;gap:24px;flex-wrap:wrap;justify-content:center;">
                  <span style="font-family:'SF Mono',monospace;font-size:11px;font-weight:500;color:rgba(255,255,255,0.15);">Unreal Engine 5.7</span>
                  <span style="font-family:'SF Mono',monospace;font-size:11px;font-weight:500;color:rgba(255,255,255,0.15);">Meta Quest 3</span>
                  <span style="font-family:'SF Mono',monospace;font-size:11px;font-weight:500;color:rgba(255,255,255,0.15);">Meta OpenXR</span>
                  <span style="font-family:'SF Mono',monospace;font-size:11px;font-weight:500;color:rgba(255,255,255,0.15);">Take Recorder</span>
                  <span style="font-family:'SF Mono',monospace;font-size:11px;font-weight:500;color:rgba(255,255,255,0.15);">Perforce</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== SPATIAL PRODUCTION PAGE ==================== -->
        <div id="page-spatial" style="display:none;">
          <div class="preview-section">
            <div class="preview-section-label">Architecture Diagram</div>
            <div class="component-wrap" data-comp="spatial-arch" onclick="selectComp(this)">
              <span class="comp-tag">ARCHITECTURE SVG</span>
              <div class="p-glass" id="preview-spatial-arch">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                  <span class="p-card-label">System Architecture</span>
                  <span><span class="p-live-dot"></span><span class="p-live-label">LIVE</span></span>
                </div>
                <svg viewBox="0 0 800 280" style="width:100%;">
                  <!-- Quest 3 -->
                  <rect x="40" y="40" width="200" height="130" rx="16" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/>
                  <circle cx="110" cy="105" r="35" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                  <circle cx="160" cy="105" r="35" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                  <circle cx="100" cy="50" r="4" fill="#34c759"/>
                  <text x="140" y="200" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="14" font-family="SF Pro Text, sans-serif">Quest 3 / Pro</text>
                  <text x="140" y="218" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-size="11" font-family="SF Mono, monospace">6DOF TRACKING</text>
                  <!-- WiFi -->
                  <path d="M310 85 Q330 65 350 85" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="1.5"/>
                  <path d="M318 92 Q330 78 342 92" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="1.5"/>
                  <text x="330" y="115" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="11" font-family="SF Mono, monospace">WiFi 6DOF</text>
                  <!-- CineCamera -->
                  <rect x="440" y="40" width="200" height="130" rx="16" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/>
                  <rect x="510" y="75" width="60" height="40" rx="6" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                  <rect x="500" y="80" width="15" height="30" rx="3" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                  <circle cx="600" cy="50" r="4" fill="#ff3b30"/>
                  <text x="540" y="200" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="14" font-family="SF Pro Text, sans-serif">CineCamera</text>
                  <text x="540" y="218" text-anchor="middle" fill="rgba(255,255,255,0.35)" font-size="11" font-family="SF Mono, monospace">VIRTUAL CAMERA</text>
                  <!-- UE Bar -->
                  <rect x="200" y="240" width="300" height="36" rx="18" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                  <text x="350" y="263" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="14" font-family="SF Mono, monospace" letter-spacing="2">Unreal Engine 5.7</text>
                </svg>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Five Architectural Layers</div>
            <div class="component-wrap" data-comp="spatial-layers" onclick="selectComp(this)">
              <span class="comp-tag">FIVE LAYERS</span>
              <div class="p-glass" id="preview-spatial-layers">
                <div class="p-section-label">ARCHITECTURAL LAYERS</div>
                <div id="layers-list">
                  <div style="display:flex;align-items:center;padding:14px 0;border-bottom:1px solid rgba(255,255,255,0.06);">
                    <span class="p-layer-num">1</span>
                    <div><div style="font-size:15px;color:rgba(255,255,255,0.95);">UE World</div><div style="font-size:13px;color:rgba(255,255,255,0.5);">Core Unreal level with all assets, lighting, and physics</div></div>
                  </div>
                  <div style="display:flex;align-items:center;padding:14px 0;border-bottom:1px solid rgba(255,255,255,0.06);">
                    <span class="p-layer-num">2</span>
                    <div><div style="font-size:15px;color:rgba(255,255,255,0.95);">Capture Process</div><div style="font-size:13px;color:rgba(255,255,255,0.5);">VR motion capture with Take Recorder and role system</div></div>
                  </div>
                  <div style="display:flex;align-items:center;padding:14px 0;border-bottom:1px solid rgba(255,255,255,0.06);">
                    <span class="p-layer-num">3</span>
                    <div><div style="font-size:15px;color:rgba(255,255,255,0.95);">Export Process</div><div style="font-size:13px;color:rgba(255,255,255,0.5);">Level Sequence ‚Üí MRQ ‚Üí Premiere/Resolve</div></div>
                  </div>
                  <div style="display:flex;align-items:center;padding:14px 0;border-bottom:1px solid rgba(255,255,255,0.06);">
                    <span class="p-layer-num">4</span>
                    <div><div style="font-size:15px;color:rgba(255,255,255,0.95);">Standalone Review App</div><div style="font-size:13px;color:rgba(255,255,255,0.5);">Lightweight non-interactive build for stakeholder review</div></div>
                  </div>
                  <div style="display:flex;align-items:center;padding:14px 0;">
                    <span class="p-layer-num">5</span>
                    <div><div style="font-size:15px;color:rgba(255,255,255,0.95);">Quest 3 Streaming App</div><div style="font-size:13px;color:rgba(255,255,255,0.5);">Standalone Quest 3 app connecting untethered via WiFi</div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Component Cards</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
              <div class="component-wrap" data-comp="spatial-card-take" onclick="selectComp(this)">
                <span class="comp-tag">TAKE RECORDER</span>
                <div class="p-glass-sm" id="preview-card-take">
                  <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(255,59,48,0.15);font-size:16px;margin-bottom:12px;">‚è∫</div>
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Take Recorder</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);line-height:1.5;">Multi-track motion capture with automatic take management.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="spatial-card-role" onclick="selectComp(this)">
                <span class="comp-tag">VR ROLE SYSTEM</span>
                <div class="p-glass-sm" id="preview-card-role">
                  <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(0,130,251,0.15);font-size:16px;margin-bottom:12px;">üë§</div>
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">VR Role System</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);line-height:1.5;">IVRRole interface: Actor, Puppeteer, Director modes.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="spatial-card-export" onclick="selectComp(this)">
                <span class="comp-tag">EXPORT PIPELINE</span>
                <div class="p-glass-sm" id="preview-card-export">
                  <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(52,199,89,0.15);font-size:16px;margin-bottom:12px;">üì§</div>
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Export Pipeline</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);line-height:1.5;">Level Sequence ‚Üí Movie Render Queue ‚Üí Editorial.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Status Tracker</div>
            <div class="component-wrap" data-comp="spatial-status" onclick="selectComp(this)">
              <span class="comp-tag">STATUS TABLE</span>
              <div class="p-glass" id="preview-spatial-status">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                  <span class="p-card-label">Component Status</span>
                  <span><span class="p-live-dot"></span><span class="p-live-label">LIVE</span></span>
                </div>
                <table class="p-comp-table">
                  <thead>
                    <tr>
                      <th style="color:rgba(255,255,255,0.4);">Component</th>
                      <th style="color:rgba(255,255,255,0.4);">Module</th>
                      <th style="color:rgba(255,255,255,0.4);">Status</th>
                      <th style="color:rgba(255,255,255,0.4);">Priority</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>VR Pawn + Roles</td>
                      <td><span style="color:#0082fb;font-size:11px;font-family:'SF Mono',monospace;">VRProduction</span></td>
                      <td><span class="p-status-badge p-status-progress">In Progress</span></td>
                      <td style="color:#ff3b30;">High</td>
                    </tr>
                    <tr>
                      <td>Take Recorder</td>
                      <td><span style="color:#0082fb;font-size:11px;font-family:'SF Mono',monospace;">VRProduction</span></td>
                      <td><span class="p-status-badge p-status-specced">Specced</span></td>
                      <td style="color:#ff3b30;">High</td>
                    </tr>
                    <tr>
                      <td>WorldEngine</td>
                      <td><span style="color:#34c759;font-size:11px;font-family:'SF Mono',monospace;">WorldEngine</span></td>
                      <td><span class="p-status-badge p-status-not-started">Not Started</span></td>
                      <td style="color:#ff9f0a;">Medium</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== COMPOUND ASSETS PAGE ==================== -->
        <div id="page-compound" style="display:none;">
          <div class="preview-section">
            <div class="preview-section-label">Asset Layers Diagram</div>
            <div class="component-wrap" data-comp="compound-layers" onclick="selectComp(this)">
              <span class="comp-tag">ASSET LAYERS</span>
              <div class="p-glass" id="preview-compound-layers">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                  <span class="p-section-label" style="margin:0;">ASSET LAYERS</span>
                  <span style="font-size:10px;letter-spacing:1px;color:rgba(255,255,255,0.25);font-family:'SF Mono',monospace;">ASSET-LAYER-DIA</span>
                </div>
                <div id="asset-layers-stack">
                  <div class="p-asset-layer" style="border-left:3px solid #ff9f0a;color:#ff9f0a;">Metadata + Tags</div>
                  <div class="p-asset-layer" style="border-left:3px solid #34c759;color:#34c759;">LOD Variants</div>
                  <div class="p-asset-layer" style="border-left:3px solid #0082fb;color:#0082fb;">Lighting Data</div>
                  <div class="p-asset-layer" style="border-left:3px solid #00d4aa;color:#00d4aa;">Materials + Textures</div>
                  <div class="p-asset-layer" style="border-left:3px solid #bf5af2;color:#bf5af2;">Collision / Physics</div>
                  <div class="p-asset-layer" style="border-left:3px solid rgba(255,255,255,0.2);color:rgba(255,255,255,0.4);">Base Geometry</div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Comparison Table</div>
            <div class="component-wrap" data-comp="compound-comparison" onclick="selectComp(this)">
              <span class="comp-tag">COMPARISON TABLE</span>
              <div class="p-glass" id="preview-compound-comparison">
                <div class="p-section-label">COMPARISON TABLE</div>
                <table class="p-comp-table">
                  <thead>
                    <tr>
                      <th style="color:rgba(255,255,255,0.4);"></th>
                      <th style="color:#ff9f0a;">Traditional</th>
                      <th style="color:#34c759;">Compound</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td>Asset Update</td><td>Rebuild from scratch</td><td>Update single layer</td></tr>
                    <tr><td>LOD Management</td><td>Manual per-asset</td><td>Automatic Nanite</td></tr>
                    <tr><td>Collaboration</td><td>File locks</td><td>Layer-level merge</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Benefit Cards</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
              <div class="component-wrap" data-comp="compound-benefit-nd" onclick="selectComp(this)">
                <span class="comp-tag">NON-DESTRUCTIVE</span>
                <div class="p-glass-sm" style="border-top:2px solid #0082fb;">
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Non-Destructive</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);">Edit any layer without affecting others.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="compound-benefit-va" onclick="selectComp(this)">
                <span class="comp-tag">VERSION AWARE</span>
                <div class="p-glass-sm" style="border-top:2px solid #34c759;">
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Version Aware</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);">Track changes per layer with full history.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="compound-benefit-pr" onclick="selectComp(this)">
                <span class="comp-tag">PIPELINE READY</span>
                <div class="p-glass-sm" style="border-top:2px solid #ff9f0a;">
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Pipeline Ready</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);">Integrates with existing DCC tools.</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== WORLD BUILDING PAGE ==================== -->
        <div id="page-world" style="display:none;">
          <div class="preview-section">
            <div class="preview-section-label">World State Network</div>
            <div class="component-wrap" data-comp="world-network" onclick="selectComp(this)">
              <span class="comp-tag">WORLD STATE NETWORK</span>
              <div class="p-glass" id="preview-world-network">
                <div class="p-card-label" style="margin-bottom:20px;">World State Network</div>
                <div style="display:flex;align-items:center;justify-content:center;gap:24px;padding:20px 0;">
                  <div style="text-align:center;">
                    <div style="width:80px;height:80px;border-radius:50%;border:2px solid #34c759;display:flex;align-items:center;justify-content:center;">
                      <span style="font-size:12px;color:#34c759;font-family:'SF Mono',monospace;">Mangrove</span>
                    </div>
                  </div>
                  <div style="text-align:center;">
                    <div style="width:80px;height:80px;border-radius:50%;border:2px solid #34c759;display:flex;align-items:center;justify-content:center;">
                      <span style="font-size:12px;color:#34c759;font-family:'SF Mono',monospace;">Encampment</span>
                    </div>
                  </div>
                  <span style="color:rgba(255,255,255,0.3);">‚Üí</span>
                  <div style="text-align:center;">
                    <div style="width:100px;height:100px;border-radius:50%;border:2px solid #00d4aa;display:flex;align-items:center;justify-content:center;">
                      <span style="font-size:13px;color:#00d4aa;font-family:'SF Mono',monospace;text-align:center;">World<br>State</span>
                    </div>
                  </div>
                  <span style="color:rgba(255,255,255,0.3);">‚Üí</span>
                  <div style="text-align:center;">
                    <div style="width:80px;height:80px;border-radius:50%;border:2px solid #bf5af2;display:flex;align-items:center;justify-content:center;">
                      <span style="font-size:12px;color:#bf5af2;font-family:'SF Mono',monospace;">DINOv2</span>
                    </div>
                    <div style="font-size:10px;color:rgba(255,255,255,0.35);margin-top:6px;">Scene Understanding</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">System Cards</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
              <div class="component-wrap" data-comp="world-card-biomes" onclick="selectComp(this)">
                <span class="comp-tag">REACTIVE BIOMES</span>
                <div class="p-glass-sm">
                  <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(52,199,89,0.15);font-size:16px;margin-bottom:12px;">üåø</div>
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Reactive Biomes</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);line-height:1.5;">Flora and fauna respond to world state changes in real-time.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="world-card-memory" onclick="selectComp(this)">
                <span class="comp-tag">PERSISTENT MEMORY</span>
                <div class="p-glass-sm">
                  <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(0,130,251,0.15);font-size:16px;margin-bottom:12px;">üíæ</div>
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">Persistent Memory</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);line-height:1.5;">World remembers past events and evolves accordingly.</div>
                </div>
              </div>
              <div class="component-wrap" data-comp="world-card-ai" onclick="selectComp(this)">
                <span class="comp-tag">AI INTEGRATION</span>
                <div class="p-glass-sm">
                  <div class="p-icon-circle" style="width:36px;height:36px;background:rgba(191,90,242,0.15);font-size:16px;margin-bottom:12px;">üß†</div>
                  <div style="font-size:15px;font-weight:600;margin-bottom:6px;">AI Integration</div>
                  <div style="font-size:13px;color:rgba(255,255,255,0.5);line-height:1.5;">DINOv2 scene understanding for intelligent world responses.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-section">
            <div class="preview-section-label">Closing Statement</div>
            <div class="component-wrap" data-comp="world-closing" onclick="selectComp(this)">
              <span class="comp-tag">CLOSING</span>
              <div class="p-glass" id="preview-world-closing" style="border-left:3px solid #00d4aa;">
                <div style="font-size:20px;font-style:italic;line-height:1.8;color:rgba(255,255,255,0.7);">The initial proof-of-concept is a simulation ‚Äî it reacts, it remembers, and it evolves with the story being told inside it.</div>
              </div>
            </div>
          </div>
        </div>

      </div><!-- /preview-canvas -->
    </div><!-- /preview-area -->
  </div><!-- /app -->

  <script>
  (function() {
    // ============================================================
    // STATE
    // ============================================================
    var currentComp = null;
    var currentPage = 'universal';

    // ============================================================
    // COMPONENT PROPERTY DEFINITIONS
    // Universal class + instance properties for each component
    // ============================================================
    var PROPS = {
      // --- UNIVERSAL ---
      'colors': {
        groups: [
          { title: 'Color Palette', badge: 'universal', props: [
            { label: 'Meta Blue', type: 'color', target: 'accent-blue', value: '#0082fb' },
            { label: 'Green', type: 'color', target: 'accent-green', value: '#34c759' },
            { label: 'Cyan', type: 'color', target: 'accent-cyan', value: '#00d4aa' },
            { label: 'Red', type: 'color', target: 'accent-red', value: '#ff3b30' },
            { label: 'Orange', type: 'color', target: 'accent-orange', value: '#ff9f0a' },
            { label: 'Purple', type: 'color', target: 'accent-purple', value: '#bf5af2' },
            { label: 'BG Primary', type: 'color', target: 'bg-primary', value: '#0a0a0c' },
          ]},
          { title: 'Text Colors', badge: 'universal', props: [
            { label: 'Primary', type: 'slider', target: 'text-primary-opacity', value: 95, min: 0, max: 100, unit: '%' },
            { label: 'Secondary', type: 'slider', target: 'text-secondary-opacity', value: 60, min: 0, max: 100, unit: '%' },
            { label: 'Tertiary', type: 'slider', target: 'text-tertiary-opacity', value: 35, min: 0, max: 100, unit: '%' },
          ]}
        ]
      },
      'typography': {
        groups: [
          { title: 'Hero Title', badge: 'universal', props: [
            { label: 'Font Size', type: 'slider', target: 'typo-h1-size', value: 72, min: 24, max: 120, unit: 'px', apply: function(v) { document.getElementById('typo-h1').style.fontSize = v + 'px'; } },
            { label: 'Weight', type: 'slider', target: 'typo-h1-weight', value: 700, min: 100, max: 900, unit: '', step: 100, apply: function(v) { document.getElementById('typo-h1').style.fontWeight = v; } },
            { label: 'Spacing', type: 'slider', target: 'typo-h1-spacing', value: -2, min: -5, max: 5, unit: 'px', apply: function(v) { document.getElementById('typo-h1').style.letterSpacing = v + 'px'; } },
          ]},
          { title: 'Section Title', badge: 'universal', props: [
            { label: 'Font Size', type: 'slider', target: 'typo-h2-size', value: 56, min: 20, max: 96, unit: 'px', apply: function(v) { document.getElementById('typo-h2').style.fontSize = v + 'px'; } },
            { label: 'Weight', type: 'slider', target: 'typo-h2-weight', value: 600, min: 100, max: 900, unit: '', step: 100, apply: function(v) { document.getElementById('typo-h2').style.fontWeight = v; } },
          ]},
          { title: 'Body Text', badge: 'universal', props: [
            { label: 'Font Size', type: 'slider', target: 'typo-body-size', value: 18, min: 12, max: 28, unit: 'px', apply: function(v) { document.getElementById('typo-body').style.fontSize = v + 'px'; } },
            { label: 'Line Height', type: 'slider', target: 'typo-body-lh', value: 1.7, min: 1, max: 2.5, unit: '', step: 0.1, apply: function(v) { document.getElementById('typo-body').style.lineHeight = v; } },
          ]},
          { title: 'Section Label', badge: 'universal', props: [
            { label: 'Font Size', type: 'slider', target: 'typo-label-size', value: 11, min: 8, max: 18, unit: 'px', apply: function(v) { document.getElementById('typo-label').style.fontSize = v + 'px'; } },
            { label: 'Spacing', type: 'slider', target: 'typo-label-spacing', value: 3, min: 0, max: 8, unit: 'px', apply: function(v) { document.getElementById('typo-label').style.letterSpacing = v + 'px'; } },
          ]},
          { title: 'Card Label', badge: 'universal', props: [
            { label: 'Font Size', type: 'slider', target: 'typo-card-size', value: 15, min: 10, max: 24, unit: 'px', apply: function(v) { document.getElementById('typo-card-label').style.fontSize = v + 'px'; } },
            { label: 'Spacing', type: 'slider', target: 'typo-card-spacing', value: 2, min: 0, max: 6, unit: 'px', apply: function(v) { document.getElementById('typo-card-label').style.letterSpacing = v + 'px'; } },
          ]}
        ]
      },
      'glass': {
        groups: [
          { title: 'Glass Container', badge: 'universal', props: [
            { label: 'Border Radius', type: 'slider', target: 'glass-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { applyAll('.p-glass', 'borderRadius', v + 'px'); } },
            { label: 'Border Opacity', type: 'slider', target: 'glass-border-op', value: 8, min: 0, max: 50, unit: '%', apply: function(v) { applyAll('.p-glass', 'borderColor', 'rgba(255,255,255,' + (v/100) + ')'); } },
            { label: 'Blur', type: 'slider', target: 'glass-blur', value: 12, min: 0, max: 40, unit: 'px', apply: function(v) { applyAll('.p-glass', 'backdropFilter', 'blur(' + v + 'px)'); applyAll('.p-glass', 'webkitBackdropFilter', 'blur(' + v + 'px)'); } },
            { label: 'BG Opacity', type: 'slider', target: 'glass-bg-op', value: 4, min: 0, max: 30, unit: '%', apply: function(v) { applyAll('.p-glass', 'background', 'rgba(255,255,255,' + (v/100) + ')'); } },
            { label: 'Padding', type: 'slider', target: 'glass-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { applyAll('.p-glass', 'padding', v + 'px'); } },
            { label: 'Shadow Blur', type: 'slider', target: 'glass-shadow', value: 60, min: 0, max: 100, unit: 'px', apply: function(v) { applyAll('.p-glass', 'boxShadow', '0 20px ' + v + 'px rgba(0,0,0,0.3)'); } },
          ]},
          { title: 'Instance: This Container', badge: 'instance', props: [
            { label: 'Content', type: 'text', target: 'glass-content', value: 'Glass Container' },
          ]}
        ]
      },
      'glass-sm': {
        groups: [
          { title: 'Glass SM (Universal)', badge: 'universal', props: [
            { label: 'Border Radius', type: 'slider', target: 'glass-sm-radius', value: 16, min: 0, max: 32, unit: 'px', apply: function(v) { applyAll('.p-glass-sm', 'borderRadius', v + 'px'); } },
            { label: 'Border Opacity', type: 'slider', target: 'glass-sm-border-op', value: 8, min: 0, max: 50, unit: '%', apply: function(v) { applyAll('.p-glass-sm', 'borderColor', 'rgba(255,255,255,' + (v/100) + ')'); } },
            { label: 'Blur', type: 'slider', target: 'glass-sm-blur', value: 12, min: 0, max: 40, unit: 'px', apply: function(v) { applyAll('.p-glass-sm', 'backdropFilter', 'blur(' + v + 'px)'); applyAll('.p-glass-sm', 'webkitBackdropFilter', 'blur(' + v + 'px)'); } },
            { label: 'BG Opacity', type: 'slider', target: 'glass-sm-bg-op', value: 4, min: 0, max: 30, unit: '%', apply: function(v) { applyAll('.p-glass-sm', 'background', 'rgba(255,255,255,' + (v/100) + ')'); } },
            { label: 'Padding', type: 'slider', target: 'glass-sm-padding', value: 20, min: 8, max: 40, unit: 'px', apply: function(v) { applyAll('.p-glass-sm', 'padding', v + 'px'); } },
          ]}
        ]
      },
      'badges': {
        groups: [
          { title: 'Hero Badge', badge: 'universal', props: [
            { label: 'Border Radius', type: 'slider', target: 'badge-radius', value: 100, min: 0, max: 100, unit: 'px', apply: function(v) { q('#preview-hero-badge').style.borderRadius = v + 'px'; } },
            { label: 'Font Size', type: 'slider', target: 'badge-font', value: 12, min: 8, max: 18, unit: 'px', apply: function(v) { q('#preview-hero-badge').style.fontSize = v + 'px'; } },
            { label: 'Spacing', type: 'slider', target: 'badge-spacing', value: 2, min: 0, max: 6, unit: 'px', apply: function(v) { q('#preview-hero-badge').style.letterSpacing = v + 'px'; } },
            { label: 'Padding V', type: 'slider', target: 'badge-pad-v', value: 6, min: 2, max: 16, unit: 'px', apply: function(v) { q('#preview-hero-badge').style.paddingTop = v + 'px'; q('#preview-hero-badge').style.paddingBottom = v + 'px'; } },
            { label: 'Padding H', type: 'slider', target: 'badge-pad-h', value: 16, min: 4, max: 32, unit: 'px', apply: function(v) { q('#preview-hero-badge').style.paddingLeft = v + 'px'; q('#preview-hero-badge').style.paddingRight = v + 'px'; } },
          ]},
          { title: 'Status Badges', badge: 'universal', props: [
            { label: 'Border Radius', type: 'slider', target: 'status-radius', value: 20, min: 0, max: 30, unit: 'px', apply: function(v) { applyAll('.p-status-badge', 'borderRadius', v + 'px'); } },
            { label: 'Font Size', type: 'slider', target: 'status-font', value: 11, min: 8, max: 16, unit: 'px', apply: function(v) { applyAll('.p-status-badge', 'fontSize', v + 'px'); } },
            { label: 'In Progress', type: 'color', target: 'status-progress-color', value: '#0082fb' },
            { label: 'Specced', type: 'color', target: 'status-specced-color', value: '#34c759' },
          ]},
          { title: 'Tech Tags', badge: 'universal', props: [
            { label: 'Border Radius', type: 'slider', target: 'tag-radius', value: 8, min: 0, max: 20, unit: 'px', apply: function(v) { applyAll('.p-tech-tag', 'borderRadius', v + 'px'); } },
            { label: 'Font Size', type: 'slider', target: 'tag-font', value: 11, min: 8, max: 16, unit: 'px', apply: function(v) { applyAll('.p-tech-tag', 'fontSize', v + 'px'); } },
            { label: 'Padding V', type: 'slider', target: 'tag-pad-v', value: 6, min: 2, max: 14, unit: 'px', apply: function(v) { applyAll('.p-tech-tag', 'paddingTop', v + 'px'); applyAll('.p-tech-tag', 'paddingBottom', v + 'px'); } },
            { label: 'Padding H', type: 'slider', target: 'tag-pad-h', value: 14, min: 4, max: 28, unit: 'px', apply: function(v) { applyAll('.p-tech-tag', 'paddingLeft', v + 'px'); applyAll('.p-tech-tag', 'paddingRight', v + 'px'); } },
          ]}
        ]
      },
      'legend': {
        groups: [
          { title: 'Live Indicator', badge: 'universal', props: [
            { label: 'Dot Size', type: 'slider', target: 'live-dot-size', value: 6, min: 4, max: 12, unit: 'px', apply: function(v) { applyAll('.p-live-dot', 'width', v + 'px'); applyAll('.p-live-dot', 'height', v + 'px'); } },
            { label: 'Color', type: 'color', target: 'live-color', value: '#34c759' },
            { label: 'Font Size', type: 'slider', target: 'live-font', value: 11, min: 8, max: 16, unit: 'px', apply: function(v) { applyAll('.p-live-label', 'fontSize', v + 'px'); } },
          ]},
          { title: 'Legend', badge: 'universal', props: [
            { label: 'Dot Size', type: 'slider', target: 'legend-dot-size', value: 8, min: 4, max: 16, unit: 'px', apply: function(v) { applyAll('.p-legend-dot', 'width', v + 'px'); applyAll('.p-legend-dot', 'height', v + 'px'); } },
            { label: 'Label Size', type: 'slider', target: 'legend-label-size', value: 12, min: 8, max: 18, unit: 'px', apply: function(v) { applyAll('.p-legend-label', 'fontSize', v + 'px'); } },
          ]}
        ]
      },
      'icon-circles': {
        groups: [
          { title: 'Icon Circles', badge: 'universal', props: [
            { label: 'Large Size', type: 'slider', target: 'icon-lg-size', value: 48, min: 24, max: 72, unit: 'px' },
            { label: 'Small Size', type: 'slider', target: 'icon-sm-size', value: 36, min: 20, max: 56, unit: 'px' },
            { label: 'Icon Font', type: 'slider', target: 'icon-font-lg', value: 20, min: 12, max: 36, unit: 'px' },
            { label: 'BG Opacity', type: 'slider', target: 'icon-bg-op', value: 15, min: 0, max: 40, unit: '%' },
          ]}
        ]
      },

      // --- HOME PAGE ---
      'home-hero': {
        groups: [
          { title: 'Typography', badge: 'universal', props: [
            { label: 'Badge Size', type: 'slider', target: 'home-hero-badge-size', value: 48, min: 24, max: 80, unit: 'px' },
            { label: 'Badge Weight', type: 'slider', target: 'home-hero-badge-weight', value: 700, min: 100, max: 900, unit: '', step: 100 },
            { label: 'Subtitle Size', type: 'slider', target: 'home-hero-sub-size', value: 18, min: 12, max: 28, unit: 'px' },
            { label: 'Subtitle Line Height', type: 'slider', target: 'home-hero-sub-lh', value: 1.7, min: 1, max: 2.5, unit: '', step: 0.1 },
            { label: 'Meta Size', type: 'slider', target: 'home-hero-meta-size', value: 13, min: 10, max: 20, unit: 'px' },
          ]},
          { title: 'Instance: Layout', badge: 'instance', props: [
            { label: 'Padding V', type: 'slider', target: 'home-hero-pad-v', value: 60, min: 20, max: 120, unit: 'px', apply: function(v) { q('#preview-home-hero').style.paddingTop = v + 'px'; q('#preview-home-hero').style.paddingBottom = v + 'px'; } },
            { label: 'Min Height', type: 'slider', target: 'home-hero-min-h', value: 280, min: 150, max: 500, unit: 'px', apply: function(v) { q('#preview-home-hero').style.minHeight = v + 'px'; } },
            { label: 'Max Width (subtitle)', type: 'slider', target: 'home-hero-max-w', value: 640, min: 400, max: 900, unit: 'px' },
          ]},
          { title: 'Instance: Colors', badge: 'instance', props: [
            { label: 'Subtitle Color', type: 'color', target: 'home-hero-sub-color', value: '#999999' },
            { label: 'Subtitle Opacity', type: 'slider', target: 'home-hero-sub-op', value: 60, min: 20, max: 100, unit: '%' },
            { label: 'Meta Text Opacity', type: 'slider', target: 'home-hero-meta-op', value: 35, min: 10, max: 80, unit: '%' },
          ]},
          { title: 'Instance: Content', badge: 'instance', props: [
            { label: 'Badge Text', type: 'text', target: 'home-hero-badge-text', value: 'Home' },
            { label: 'Subtitle', type: 'text', target: 'home-hero-sub-text', value: 'A modular, portable virtual production pipeline built on Meta hardware and Unreal Engine 5.7.' },
            { label: 'Author', type: 'text', target: 'home-hero-author', value: 'By Aniket Bhatt' },
          ]}
        ]
      },
      'home-pillar-spatial': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'hp-s-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-pillar-spatial').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'hp-s-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-pillar-spatial').style.padding = v + 'px'; } },
          { label: 'Border Opacity', type: 'slider', target: 'hp-s-border-op', value: 38, min: 0, max: 100, unit: '%' },
        ]},
        { title: 'Instance: Icon', badge: 'instance', props: [
          { label: 'Icon BG Opacity', type: 'slider', target: 'hp-s-icon-bg-op', value: 4, min: 0, max: 30, unit: '%' },
          { label: 'Icon Size', type: 'slider', target: 'hp-s-icon-size', value: 48, min: 32, max: 72, unit: 'px' },
          { label: 'Icon Radius', type: 'slider', target: 'hp-s-icon-radius', value: 14, min: 0, max: 24, unit: 'px' },
        ]},
        { title: 'Instance: Typography', badge: 'instance', props: [
          { label: 'Title Size', type: 'slider', target: 'hp-s-title-size', value: 20, min: 14, max: 32, unit: 'px' },
          { label: 'Title Weight', type: 'slider', target: 'hp-s-title-weight', value: 600, min: 400, max: 800, unit: '', step: 100 },
          { label: 'Title Spacing', type: 'slider', target: 'hp-s-title-ls', value: -0.02, min: -0.05, max: 0.05, unit: 'em', step: 0.01 },
          { label: 'Desc Size', type: 'slider', target: 'hp-s-desc-size', value: 15, min: 10, max: 22, unit: 'px' },
          { label: 'Desc Line Height', type: 'slider', target: 'hp-s-desc-lh', value: 1.6, min: 1, max: 2.2, unit: '', step: 0.1 },
          { label: 'Desc Opacity', type: 'slider', target: 'hp-s-desc-op', value: 55, min: 20, max: 100, unit: '%' },
          { label: 'Arrow Size', type: 'slider', target: 'hp-s-arrow-size', value: 13, min: 10, max: 18, unit: 'px' },
          { label: 'Arrow Color', type: 'color', target: 'hp-s-arrow-color', value: '#0082fb' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'hp-s-title', value: 'Meta Production Tools' },
          { label: 'Description', type: 'text', target: 'hp-s-desc', value: 'A project-agnostic, portable filmmaking toolkit designed as a self-contained UE5 plugin.' },
        ]}
      ]},
      'home-pillar-assets': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'hp-a-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-pillar-assets').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'hp-a-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-pillar-assets').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Typography', badge: 'instance', props: [
          { label: 'Title Size', type: 'slider', target: 'hp-a-title-size', value: 20, min: 14, max: 32, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'hp-a-desc-size', value: 15, min: 10, max: 22, unit: 'px' },
          { label: 'Desc Opacity', type: 'slider', target: 'hp-a-desc-op', value: 55, min: 20, max: 100, unit: '%' },
          { label: 'Arrow Color', type: 'color', target: 'hp-a-arrow-color', value: '#0082fb' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'hp-a-title', value: 'Compound Asset Pipeline' },
          { label: 'Description', type: 'text', target: 'hp-a-desc', value: 'Assets are layered, interconnected structures. Build once, compound everywhere.' },
        ]}
      ]},
      'home-pillar-world': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'hp-w-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-pillar-world').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'hp-w-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-pillar-world').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Typography', badge: 'instance', props: [
          { label: 'Title Size', type: 'slider', target: 'hp-w-title-size', value: 20, min: 14, max: 32, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'hp-w-desc-size', value: 15, min: 10, max: 22, unit: 'px' },
          { label: 'Desc Opacity', type: 'slider', target: 'hp-w-desc-op', value: 55, min: 20, max: 100, unit: '%' },
          { label: 'Arrow Color', type: 'color', target: 'hp-w-arrow-color', value: '#0082fb' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'hp-w-title', value: 'World Building Neural Network' },
          { label: 'Description', type: 'text', target: 'hp-w-desc', value: 'A project-specific simulation layer modeling the world as a coherent mechanistic system.' },
        ]}
      ]},
      'home-footer': { groups: [
        { title: 'Footer Layout', badge: 'universal', props: [
          { label: 'Border Opacity', type: 'slider', target: 'hf-border-op', value: 8, min: 0, max: 30, unit: '%' },
          { label: 'Padding Top', type: 'slider', target: 'hf-pad-top', value: 48, min: 16, max: 96, unit: 'px' },
          { label: 'Padding Bottom', type: 'slider', target: 'hf-pad-bottom', value: 64, min: 16, max: 96, unit: 'px' },
          { label: 'Gap', type: 'slider', target: 'hf-gap', value: 20, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Typography', badge: 'instance', props: [
          { label: 'Credit Size', type: 'slider', target: 'hf-credit-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Credit Opacity', type: 'slider', target: 'hf-credit-op', value: 55, min: 20, max: 100, unit: '%' },
          { label: 'Role Size', type: 'slider', target: 'hf-role-size', value: 13, min: 10, max: 18, unit: 'px' },
          { label: 'Role Opacity', type: 'slider', target: 'hf-role-op', value: 25, min: 10, max: 60, unit: '%' },
          { label: 'Tech Font', type: 'slider', target: 'hf-tech-font', value: 11, min: 8, max: 16, unit: 'px' },
          { label: 'Tech Opacity', type: 'slider', target: 'hf-tech-op', value: 15, min: 5, max: 50, unit: '%' },
          { label: 'Tech Gap', type: 'slider', target: 'hf-tech-gap', value: 24, min: 8, max: 48, unit: 'px' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Credit Name', type: 'text', target: 'hf-credit-name', value: 'Aniket Bhatt' },
          { label: 'Role Text', type: 'text', target: 'hf-role-text', value: 'Meta Creative Core - Production Design + XR' },
        ]}
      ]},

      // --- SPATIAL PAGE ---
      'spatial-arch': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'sa-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-spatial-arch').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'sa-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-spatial-arch').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Device Boxes', badge: 'instance', props: [
          { label: 'Box Stroke Opacity', type: 'slider', target: 'sa-stroke-op', value: 40, min: 10, max: 100, unit: '%' },
          { label: 'Box Stroke Width', type: 'slider', target: 'sa-stroke-w', value: 1.5, min: 0.5, max: 4, unit: 'px', step: 0.5 },
          { label: 'Box Corner Radius', type: 'slider', target: 'sa-box-radius', value: 16, min: 4, max: 32, unit: 'px' },
          { label: 'Lens Stroke Opacity', type: 'slider', target: 'sa-lens-op', value: 25, min: 5, max: 60, unit: '%' },
        ]},
        { title: 'Instance: Indicators', badge: 'instance', props: [
          { label: 'Rec Dot (Green)', type: 'color', target: 'sa-dot-green', value: '#34c759' },
          { label: 'Rec Dot (Red)', type: 'color', target: 'sa-dot-red', value: '#ff3b30' },
          { label: 'Dot Radius', type: 'slider', target: 'sa-dot-r', value: 4, min: 2, max: 8, unit: 'px' },
          { label: 'WiFi Stroke Opacity', type: 'slider', target: 'sa-wifi-op', value: 50, min: 10, max: 100, unit: '%' },
          { label: 'WiFi Stroke Width', type: 'slider', target: 'sa-wifi-w', value: 1.5, min: 0.5, max: 3, unit: 'px', step: 0.5 },
        ]},
        { title: 'Instance: Labels', badge: 'instance', props: [
          { label: 'Device Label Size', type: 'slider', target: 'sa-label-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Device Label Opacity', type: 'slider', target: 'sa-label-op', value: 70, min: 20, max: 100, unit: '%' },
          { label: 'Sub Label Size', type: 'slider', target: 'sa-sublabel-size', value: 11, min: 8, max: 16, unit: 'px' },
          { label: 'Sub Label Opacity', type: 'slider', target: 'sa-sublabel-op', value: 35, min: 10, max: 70, unit: '%' },
          { label: 'WiFi Label Size', type: 'slider', target: 'sa-wifi-label-size', value: 11, min: 8, max: 16, unit: 'px' },
        ]},
        { title: 'Instance: UE Bar', badge: 'instance', props: [
          { label: 'Bar Height', type: 'slider', target: 'sa-bar-h', value: 36, min: 24, max: 48, unit: 'px' },
          { label: 'Bar Radius', type: 'slider', target: 'sa-bar-radius', value: 18, min: 4, max: 24, unit: 'px' },
          { label: 'Bar BG Opacity', type: 'slider', target: 'sa-bar-bg-op', value: 6, min: 0, max: 20, unit: '%' },
          { label: 'Bar Border Opacity', type: 'slider', target: 'sa-bar-border-op', value: 10, min: 0, max: 30, unit: '%' },
          { label: 'Bar Text Size', type: 'slider', target: 'sa-bar-text-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Bar Text', type: 'text', target: 'sa-ue-text', value: 'Unreal Engine 5.7' },
        ]}
      ]},
      'spatial-layers': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'sl-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-spatial-layers').style.borderRadius = v + 'px'; } },
        ]},
        { title: 'Instance: Layer Rows', badge: 'instance', props: [
          { label: 'Number BG', type: 'color', target: 'sl-num-bg', value: '#0082fb' },
          { label: 'Number Size', type: 'slider', target: 'sl-num-size', value: 28, min: 20, max: 40, unit: 'px' },
          { label: 'Title Size', type: 'slider', target: 'sl-title-size', value: 15, min: 12, max: 22, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'sl-desc-size', value: 13, min: 10, max: 18, unit: 'px' },
          { label: 'Row Padding', type: 'slider', target: 'sl-row-pad', value: 14, min: 6, max: 24, unit: 'px' },
          { label: 'Divider Opacity', type: 'slider', target: 'sl-divider-op', value: 6, min: 0, max: 20, unit: '%' },
        ]}
      ]},
      'spatial-card-take': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'sct-radius', value: 16, min: 0, max: 32, unit: 'px', apply: function(v) { q('#preview-card-take').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'sct-padding', value: 20, min: 8, max: 40, unit: 'px', apply: function(v) { q('#preview-card-take').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Take Recorder', badge: 'instance', props: [
          { label: 'Icon', type: 'text', target: 'sct-icon', value: '‚è∫' },
          { label: 'Icon Color', type: 'color', target: 'sct-icon-color', value: '#ff3b30' },
          { label: 'Title', type: 'text', target: 'sct-title', value: 'Take Recorder' },
          { label: 'Description', type: 'text', target: 'sct-desc', value: 'Multi-track motion capture with automatic take management.' },
          { label: 'Title Size', type: 'slider', target: 'sct-title-size', value: 15, min: 12, max: 22, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'sct-desc-size', value: 13, min: 10, max: 18, unit: 'px' },
        ]}
      ]},
      'spatial-card-role': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'scr-radius', value: 16, min: 0, max: 32, unit: 'px', apply: function(v) { q('#preview-card-role').style.borderRadius = v + 'px'; } },
        ]},
        { title: 'Instance: VR Role System', badge: 'instance', props: [
          { label: 'Icon Color', type: 'color', target: 'scr-icon-color', value: '#0082fb' },
          { label: 'Title', type: 'text', target: 'scr-title', value: 'VR Role System' },
          { label: 'Description', type: 'text', target: 'scr-desc', value: 'IVRRole interface: Actor, Puppeteer, Director modes.' },
        ]}
      ]},
      'spatial-card-export': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'sce-radius', value: 16, min: 0, max: 32, unit: 'px', apply: function(v) { q('#preview-card-export').style.borderRadius = v + 'px'; } },
        ]},
        { title: 'Instance: Export Pipeline', badge: 'instance', props: [
          { label: 'Icon Color', type: 'color', target: 'sce-icon-color', value: '#34c759' },
          { label: 'Title', type: 'text', target: 'sce-title', value: 'Export Pipeline' },
          { label: 'Description', type: 'text', target: 'sce-desc', value: 'Level Sequence ‚Üí Movie Render Queue ‚Üí Editorial.' },
        ]}
      ]},
      'spatial-status': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'ss-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-spatial-status').style.borderRadius = v + 'px'; } },
        ]},
        { title: 'Status Badges', badge: 'universal', props: [
          { label: 'Badge Radius', type: 'slider', target: 'ss-badge-radius', value: 20, min: 0, max: 30, unit: 'px' },
          { label: 'Badge Font', type: 'slider', target: 'ss-badge-font', value: 11, min: 8, max: 16, unit: 'px' },
        ]},
        { title: 'Instance: Table', badge: 'instance', props: [
          { label: 'Header Size', type: 'slider', target: 'ss-header-size', value: 11, min: 8, max: 16, unit: 'px' },
          { label: 'Cell Size', type: 'slider', target: 'ss-cell-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Row Padding', type: 'slider', target: 'ss-row-pad', value: 12, min: 6, max: 24, unit: 'px' },
          { label: 'High Priority', type: 'color', target: 'ss-high-color', value: '#ff3b30' },
          { label: 'Med Priority', type: 'color', target: 'ss-med-color', value: '#ff9f0a' },
        ]}
      ]},

      // --- COMPOUND PAGE ---
      'compound-layers': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'cl-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-compound-layers').style.borderRadius = v + 'px'; } },
        ]},
        { title: 'Instance: Layer Rows', badge: 'instance', props: [
          { label: 'Row Padding', type: 'slider', target: 'cl-row-pad', value: 16, min: 6, max: 28, unit: 'px' },
          { label: 'Row Radius', type: 'slider', target: 'cl-row-radius', value: 8, min: 0, max: 16, unit: 'px' },
          { label: 'Font Size', type: 'slider', target: 'cl-font', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Spacing', type: 'slider', target: 'cl-spacing', value: 1, min: 0, max: 4, unit: 'px' },
          { label: 'Border Width', type: 'slider', target: 'cl-border-w', value: 3, min: 1, max: 6, unit: 'px' },
          { label: 'Metadata', type: 'color', target: 'cl-color-1', value: '#ff9f0a' },
          { label: 'LOD', type: 'color', target: 'cl-color-2', value: '#34c759' },
          { label: 'Lighting', type: 'color', target: 'cl-color-3', value: '#0082fb' },
          { label: 'Materials', type: 'color', target: 'cl-color-4', value: '#00d4aa' },
          { label: 'Collision', type: 'color', target: 'cl-color-5', value: '#bf5af2' },
          { label: 'Gap', type: 'slider', target: 'cl-gap', value: 6, min: 0, max: 16, unit: 'px' },
        ]}
      ]},
      'compound-comparison': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'cc-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-compound-comparison').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'cc-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-compound-comparison').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Table Headers', badge: 'instance', props: [
          { label: 'Header Size', type: 'slider', target: 'cc-header-size', value: 13, min: 8, max: 20, unit: 'px' },
          { label: 'Header Padding', type: 'slider', target: 'cc-header-pad', value: 10, min: 4, max: 20, unit: 'px' },
          { label: 'Traditional Color', type: 'color', target: 'cc-trad-color', value: '#ff9f0a' },
          { label: 'Compound Color', type: 'color', target: 'cc-comp-color', value: '#34c759' },
        ]},
        { title: 'Instance: Table Cells', badge: 'instance', props: [
          { label: 'Cell Size', type: 'slider', target: 'cc-cell-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Cell Padding', type: 'slider', target: 'cc-cell-pad', value: 10, min: 4, max: 20, unit: 'px' },
          { label: 'Row Label Size', type: 'slider', target: 'cc-label-size', value: 12, min: 8, max: 18, unit: 'px' },
          { label: 'Row Label Opacity', type: 'slider', target: 'cc-label-op', value: 50, min: 20, max: 80, unit: '%' },
          { label: 'Trad Cell Opacity', type: 'slider', target: 'cc-trad-op', value: 50, min: 20, max: 100, unit: '%' },
          { label: 'Compound Cell Opacity', type: 'slider', target: 'cc-comp-op', value: 80, min: 40, max: 100, unit: '%' },
          { label: 'Divider Opacity', type: 'slider', target: 'cc-divider-op', value: 4, min: 0, max: 15, unit: '%' },
        ]}
      ]},
      'compound-benefit-nd': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'cb1-radius', value: 16, min: 0, max: 32, unit: 'px' },
          { label: 'Padding', type: 'slider', target: 'cb1-padding', value: 20, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Style', badge: 'instance', props: [
          { label: 'Accent Color', type: 'color', target: 'cb1-accent', value: '#0082fb' },
          { label: 'Border Top Width', type: 'slider', target: 'cb1-border-w', value: 2, min: 0, max: 6, unit: 'px' },
          { label: 'Title Size', type: 'slider', target: 'cb1-title-size', value: 15, min: 12, max: 22, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'cb1-desc-size', value: 13, min: 10, max: 18, unit: 'px' },
          { label: 'Desc Opacity', type: 'slider', target: 'cb1-desc-op', value: 50, min: 20, max: 100, unit: '%' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'cb1-title', value: 'Non-Destructive' },
          { label: 'Description', type: 'text', target: 'cb1-desc', value: 'Edit any layer without affecting others.' },
        ]}
      ]},
      'compound-benefit-va': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'cb2-radius', value: 16, min: 0, max: 32, unit: 'px' },
          { label: 'Padding', type: 'slider', target: 'cb2-padding', value: 20, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Style', badge: 'instance', props: [
          { label: 'Accent Color', type: 'color', target: 'cb2-accent', value: '#34c759' },
          { label: 'Border Top Width', type: 'slider', target: 'cb2-border-w', value: 2, min: 0, max: 6, unit: 'px' },
          { label: 'Title Size', type: 'slider', target: 'cb2-title-size', value: 15, min: 12, max: 22, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'cb2-desc-size', value: 13, min: 10, max: 18, unit: 'px' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'cb2-title', value: 'Version Aware' },
          { label: 'Description', type: 'text', target: 'cb2-desc', value: 'Track changes per layer with full history.' },
        ]}
      ]},
      'compound-benefit-pr': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'cb3-radius', value: 16, min: 0, max: 32, unit: 'px' },
          { label: 'Padding', type: 'slider', target: 'cb3-padding', value: 20, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Style', badge: 'instance', props: [
          { label: 'Accent Color', type: 'color', target: 'cb3-accent', value: '#ff9f0a' },
          { label: 'Border Top Width', type: 'slider', target: 'cb3-border-w', value: 2, min: 0, max: 6, unit: 'px' },
          { label: 'Title Size', type: 'slider', target: 'cb3-title-size', value: 15, min: 12, max: 22, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'cb3-desc-size', value: 13, min: 10, max: 18, unit: 'px' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'cb3-title', value: 'Pipeline Ready' },
          { label: 'Description', type: 'text', target: 'cb3-desc', value: 'Integrates with existing DCC tools.' },
        ]}
      ]},

      // --- WORLD PAGE ---
      'world-network': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'wn-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-world-network').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'wn-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-world-network').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Location Nodes', badge: 'instance', props: [
          { label: 'Mangrove (cyan)', type: 'color', target: 'wn-mangrove-color', value: '#4dd0e1' },
          { label: 'Caldera (red)', type: 'color', target: 'wn-caldera-color', value: '#ef5350' },
          { label: 'Encampment (green)', type: 'color', target: 'wn-encampment-color', value: '#66bb6a' },
          { label: 'Mycelium (blue)', type: 'color', target: 'wn-mycelium-color', value: '#42a5f5' },
          { label: 'Tidal (orange)', type: 'color', target: 'wn-tidal-color', value: '#ffa726' },
          { label: 'Location Radius', type: 'slider', target: 'wn-loc-radius', value: 28, min: 16, max: 48, unit: 'px' },
          { label: 'Location Stroke', type: 'slider', target: 'wn-loc-stroke', value: 1.5, min: 0.5, max: 4, unit: 'px', step: 0.5 },
          { label: 'Location Font', type: 'slider', target: 'wn-loc-font', value: 10, min: 8, max: 16, unit: 'px' },
        ]},
        { title: 'Instance: Processing Nodes', badge: 'instance', props: [
          { label: 'World State (cyan)', type: 'color', target: 'wn-state-color', value: '#4dd0e1' },
          { label: 'Story Events (red)', type: 'color', target: 'wn-story-color', value: '#ef5350' },
          { label: 'Process Radius', type: 'slider', target: 'wn-proc-radius', value: 32, min: 20, max: 50, unit: 'px' },
          { label: 'Process Stroke', type: 'slider', target: 'wn-proc-stroke', value: 1.5, min: 0.5, max: 4, unit: 'px', step: 0.5 },
          { label: 'Process Font', type: 'slider', target: 'wn-proc-font', value: 12, min: 8, max: 18, unit: 'px' },
        ]},
        { title: 'Instance: AI Nodes', badge: 'instance', props: [
          { label: 'DINOv2 (blue)', type: 'color', target: 'wn-dino-color', value: '#42a5f5' },
          { label: 'PCG (green)', type: 'color', target: 'wn-pcg-color', value: '#66bb6a' },
          { label: 'AI Radius', type: 'slider', target: 'wn-ai-radius', value: 42, min: 24, max: 60, unit: 'px' },
          { label: 'AI Stroke', type: 'slider', target: 'wn-ai-stroke', value: 2, min: 0.5, max: 5, unit: 'px', step: 0.5 },
          { label: 'AI Font', type: 'slider', target: 'wn-ai-font', value: 13, min: 8, max: 20, unit: 'px' },
          { label: 'Sub Label Font', type: 'slider', target: 'wn-ai-sub-font', value: 9, min: 6, max: 14, unit: 'px' },
        ]},
        { title: 'Instance: Output Node', badge: 'instance', props: [
          { label: 'Live World (orange)', type: 'color', target: 'wn-output-color', value: '#ffa726' },
          { label: 'Output Radius', type: 'slider', target: 'wn-output-radius', value: 34, min: 20, max: 50, unit: 'px' },
          { label: 'Output Stroke', type: 'slider', target: 'wn-output-stroke', value: 2, min: 0.5, max: 5, unit: 'px', step: 0.5 },
          { label: 'Output Font', type: 'slider', target: 'wn-output-font', value: 13, min: 8, max: 20, unit: 'px' },
        ]},
        { title: 'Instance: Connections', badge: 'instance', props: [
          { label: 'Line Width', type: 'slider', target: 'wn-line-w', value: 0.7, min: 0.3, max: 3, unit: 'px', step: 0.1 },
          { label: 'Line Opacity', type: 'slider', target: 'wn-line-op', value: 25, min: 5, max: 100, unit: '%' },
          { label: 'Dash Length', type: 'slider', target: 'wn-dash-len', value: 3, min: 1, max: 10, unit: 'px' },
          { label: 'Dash Gap', type: 'slider', target: 'wn-dash-gap', value: 3, min: 1, max: 10, unit: 'px' },
          { label: 'Cross Line Width', type: 'slider', target: 'wn-cross-w', value: 0.4, min: 0.1, max: 2, unit: 'px', step: 0.1 },
          { label: 'Cross Opacity', type: 'slider', target: 'wn-cross-op', value: 8, min: 0, max: 30, unit: '%' },
          { label: 'Particle Size', type: 'slider', target: 'wn-particle-r', value: 2, min: 1, max: 5, unit: 'px' },
          { label: 'Particle Opacity', type: 'slider', target: 'wn-particle-op', value: 60, min: 10, max: 100, unit: '%' },
          { label: 'Vertical Line Color', type: 'color', target: 'wn-vert-color', value: '#333333' },
        ]}
      ]},
      'world-card-biomes': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'wcb-radius', value: 16, min: 0, max: 32, unit: 'px' },
          { label: 'Padding', type: 'slider', target: 'wcb-padding', value: 24, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Icon', badge: 'instance', props: [
          { label: 'Icon BG Opacity', type: 'slider', target: 'wcb-icon-bg-op', value: 4, min: 0, max: 30, unit: '%' },
          { label: 'Icon Size', type: 'slider', target: 'wcb-icon-size', value: 48, min: 32, max: 72, unit: 'px' },
          { label: 'Icon Radius', type: 'slider', target: 'wcb-icon-radius', value: 14, min: 0, max: 24, unit: 'px' },
          { label: 'Icon Color', type: 'color', target: 'wcb-color', value: '#34c759' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'wcb-title', value: 'Procedural Content Generation' },
          { label: 'Description', type: 'text', target: 'wcb-desc', value: 'UE5 PCG framework generates environments from rule sets.' },
          { label: 'Title Size', type: 'slider', target: 'wcb-title-size', value: 18, min: 14, max: 28, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'wcb-desc-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Desc Opacity', type: 'slider', target: 'wcb-desc-op', value: 55, min: 20, max: 100, unit: '%' },
        ]}
      ]},
      'world-card-memory': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'wcm-radius', value: 16, min: 0, max: 32, unit: 'px' },
          { label: 'Padding', type: 'slider', target: 'wcm-padding', value: 24, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Icon', badge: 'instance', props: [
          { label: 'Icon BG Opacity', type: 'slider', target: 'wcm-icon-bg-op', value: 4, min: 0, max: 30, unit: '%' },
          { label: 'Icon Size', type: 'slider', target: 'wcm-icon-size', value: 48, min: 32, max: 72, unit: 'px' },
          { label: 'Icon Radius', type: 'slider', target: 'wcm-icon-radius', value: 14, min: 0, max: 24, unit: 'px' },
          { label: 'Icon Color', type: 'color', target: 'wcm-color', value: '#0082fb' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'wcm-title', value: 'Persistent World State' },
          { label: 'Description', type: 'text', target: 'wcm-desc', value: 'Every location maintains state across production sessions.' },
          { label: 'Title Size', type: 'slider', target: 'wcm-title-size', value: 18, min: 14, max: 28, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'wcm-desc-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Desc Opacity', type: 'slider', target: 'wcm-desc-op', value: 55, min: 20, max: 100, unit: '%' },
        ]}
      ]},
      'world-card-ai': { groups: [
        { title: 'Glass SM', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'wca-radius', value: 16, min: 0, max: 32, unit: 'px' },
          { label: 'Padding', type: 'slider', target: 'wca-padding', value: 24, min: 8, max: 40, unit: 'px' },
        ]},
        { title: 'Instance: Icon', badge: 'instance', props: [
          { label: 'Icon BG Opacity', type: 'slider', target: 'wca-icon-bg-op', value: 4, min: 0, max: 30, unit: '%' },
          { label: 'Icon Size', type: 'slider', target: 'wca-icon-size', value: 48, min: 32, max: 72, unit: 'px' },
          { label: 'Icon Radius', type: 'slider', target: 'wca-icon-radius', value: 14, min: 0, max: 24, unit: 'px' },
          { label: 'Icon Color', type: 'color', target: 'wca-color', value: '#bf5af2' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Title', type: 'text', target: 'wca-title', value: 'Modular Biome System' },
          { label: 'Description', type: 'text', target: 'wca-desc', value: 'Biomes are composable modules that can be mixed and matched.' },
          { label: 'Title Size', type: 'slider', target: 'wca-title-size', value: 18, min: 14, max: 28, unit: 'px' },
          { label: 'Desc Size', type: 'slider', target: 'wca-desc-size', value: 14, min: 10, max: 20, unit: 'px' },
          { label: 'Desc Opacity', type: 'slider', target: 'wca-desc-op', value: 55, min: 20, max: 100, unit: '%' },
        ]}
      ]},
      'world-closing': { groups: [
        { title: 'Glass Container', badge: 'universal', props: [
          { label: 'Border Radius', type: 'slider', target: 'wc-radius', value: 20, min: 0, max: 40, unit: 'px', apply: function(v) { q('#preview-world-closing').style.borderRadius = v + 'px'; } },
          { label: 'Padding', type: 'slider', target: 'wc-padding', value: 28, min: 8, max: 48, unit: 'px', apply: function(v) { q('#preview-world-closing').style.padding = v + 'px'; } },
        ]},
        { title: 'Instance: Border Accent', badge: 'instance', props: [
          { label: 'Border Color', type: 'color', target: 'wc-border-color', value: '#00d4aa' },
          { label: 'Border Width', type: 'slider', target: 'wc-border-w', value: 3, min: 1, max: 8, unit: 'px' },
          { label: 'Border Side', type: 'text', target: 'wc-border-side', value: 'left' },
        ]},
        { title: 'Instance: Quote Typography', badge: 'instance', props: [
          { label: 'Font Size', type: 'slider', target: 'wc-font-size', value: 20, min: 14, max: 32, unit: 'px', apply: function(v) { q('#preview-world-closing div').style.fontSize = v + 'px'; } },
          { label: 'Font Style', type: 'text', target: 'wc-font-style', value: 'italic' },
          { label: 'Line Height', type: 'slider', target: 'wc-line-h', value: 1.8, min: 1, max: 2.5, unit: '', step: 0.1, apply: function(v) { q('#preview-world-closing div').style.lineHeight = v; } },
          { label: 'Text Opacity', type: 'slider', target: 'wc-text-op', value: 70, min: 20, max: 100, unit: '%', apply: function(v) { q('#preview-world-closing div').style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
          { label: 'Emphasis Weight', type: 'slider', target: 'wc-em-weight', value: 500, min: 400, max: 800, unit: '', step: 100 },
          { label: 'Emphasis Color', type: 'color', target: 'wc-em-color', value: '#ffffff' },
        ]},
        { title: 'Instance: Content', badge: 'instance', props: [
          { label: 'Quote Text', type: 'text', target: 'wc-text', value: 'The initial proof-of-concept is a simulation ‚Äî it reacts, it remembers, and it evolves with the story being told inside it.' },
        ]}
      ]},
    };

    // ============================================================
    // CODE SNIPPETS ‚Äî HTML/CSS/Fallback per component
    // ============================================================
    var CODE_SNIPPETS = {
      'colors': {
        html: ':root {\n  --blue: oklch(0.62 0.20 255);  /* #0082fb */\n  --teal: oklch(0.65 0.12 195);  /* #00d4aa */\n  --green: oklch(0.68 0.16 145); /* #34c759 */\n  --orange: oklch(0.72 0.16 60); /* #ff9f0a */\n  --red: oklch(0.60 0.22 25);    /* #ff3b30 */\n  --bg: oklch(0.04 0.003 260);   /* #0a0a0c */\n  --fg: oklch(0.96 0.005 260);\n  --muted: oklch(0.55 0.01 260);\n}',
        css: '/* All colors defined as CSS custom properties in :root */\n/* Use oklch() for perceptual uniformity */\n/* Fallback hex values in comments for reference */',
        fallback: '/* oklch() is supported in all modern browsers */\n/* For IE11/legacy, use hex fallbacks: */\n:root {\n  --blue: #0082fb;\n  --green: #34c759;\n  --red: #ff3b30;\n}'
      },
      'typography': {
        html: '<h1 class="hero-title">Hero Title</h1>\n<h2 class="section-title">Section Title</h2>\n<p class="section-subtitle">Body text</p>\n<span class="section-label">SECTION LABEL</span>\n<span class="card-panel-label">CARD LABEL</span>',
        css: '.hero-title {\n  font-size: clamp(2.5rem, 6vw, 4.5rem);\n  font-weight: 700;\n  letter-spacing: -0.02em;\n}\n.section-title {\n  font-size: clamp(1.5rem, 3vw, 2rem);\n  font-weight: 600;\n}\n.section-subtitle {\n  font-size: 18px;\n  line-height: 1.7;\n  color: var(--muted);\n}',
        fallback: '/* Same styles apply ‚Äî no backdrop-filter dependency */'
      },
      'glass': {
        html: '<div class="glass-container">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <span class="card-panel-label">Title</span>\n    <p>Content here</p>\n  </div>\n</div>',
        css: '.glass-container {\n  position: relative;\n  border-radius: var(--glass-radius);\n  border: 1.5px solid var(--glass-border-color);\n  overflow: hidden;\n}\n.glass-bg {\n  position: absolute; inset: 0;\n  background: rgba(255,255,255,0.04);\n  backdrop-filter: blur(12px) saturate(1.4);\n  box-shadow: var(--glass-shadow);\n}\n.glass-content {\n  position: relative; z-index: 99;\n  padding: 28px 32px;\n}',
        fallback: '.glass-container {\n  background: rgba(30,30,35,0.95);\n  border: 1.5px solid rgba(112,112,112,0.38);\n  border-radius: 20px;\n}\n.glass-bg {\n  backdrop-filter: none;\n  background: transparent;\n}'
      },
      'glass-sm': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <span class="card-panel-label">Title</span>\n    <p>Content</p>\n  </div>\n</div>',
        css: '.glass-container.glass-sm {\n  --glass-radius: 16px;\n}\n.glass-container.glass-sm > .glass-content {\n  padding: 24px;\n}',
        fallback: '.glass-container.glass-sm {\n  background: rgba(30,30,35,0.95);\n  border-radius: 16px;\n}'
      },
      'badges': {
        html: '<span class="hero-badge">PIPELINE ARCHITECTURE</span>\n<span class="status-badge status-progress">In Progress</span>\n<span class="status-badge status-specced">Specced</span>\n<span class="status-badge status-not-started">Not Started</span>\n<span class="tech-tag">Unreal Engine 5.7</span>',
        css: '.hero-badge {\n  display: inline-block;\n  padding: 6px 16px;\n  border-radius: 100px;\n  border: 1px solid rgba(255,255,255,0.15);\n  background: rgba(255,255,255,0.06);\n  backdrop-filter: blur(24px) saturate(1.6);\n  font-size: 13px; font-weight: 500;\n  color: rgba(255,255,255,0.85);\n}\n.status-badge {\n  padding: 4px 12px;\n  border-radius: 20px;\n  font-size: 11px;\n}',
        fallback: '.hero-badge {\n  background: rgba(30,30,35,0.95);\n  backdrop-filter: none;\n}'
      },
      'legend': {
        html: '<div class="live-indicator">\n  <div class="live-dot"></div>\n  <span class="live-label">LIVE</span>\n</div>',
        css: '.live-dot {\n  width: 6px; height: 6px;\n  border-radius: 50%;\n  background: #34c759;\n  animation: pulse 2s infinite;\n}\n.live-label {\n  font-size: 11px;\n  letter-spacing: 2px;\n  color: rgba(255,255,255,0.4);\n}',
        fallback: '/* No fallback needed ‚Äî no backdrop-filter */'
      },
      'icon-circles': {
        html: '<div class="card-icon">\n  <svg><!-- icon --></svg>\n</div>',
        css: '.card-icon {\n  width: 48px; height: 48px;\n  display: flex; align-items: center;\n  justify-content: center;\n  border-radius: 14px;\n  background: rgba(255,255,255,0.04);\n  color: var(--muted);\n  margin-bottom: 20px;\n}',
        fallback: '/* No fallback needed */'
      },
      'home-hero': {
        html: '<section class="hero">\n  <div class="hero-content">\n    <div class="hero-badge" style="font-size:clamp(2.5rem,6vw,4.5rem);\n      padding:0.8rem 3rem;font-weight:700;">Home</div>\n    <p class="hero-subtitle">A modular, portable virtual\n      production pipeline...</p>\n    <div class="hero-meta">\n      <span>By Aniket Bhatt</span>\n      <span>&middot;</span>\n      <span>Unreal Engine 5.7</span>\n    </div>\n  </div>\n</section>',
        css: '.hero {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n  background: transparent;\n}\n.hero-subtitle {\n  font-size: 18px;\n  line-height: 1.7;\n  color: var(--muted);\n  max-width: 640px;\n}\n.hero-meta {\n  font-size: 13px;\n  color: var(--muted-faint);\n}',
        fallback: '/* Hero uses no backdrop-filter ‚Äî no fallback needed */'
      },
      'home-pillar-spatial': {
        html: '<a href="spatial-production.html" class="glass-container">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-icon">\n      <svg><!-- VR headset --></svg>\n    </div>\n    <h3 class="pillar-card-title">Meta Production Tools</h3>\n    <p class="pillar-card-desc">A project-agnostic, portable\n      filmmaking toolkit...</p>\n    <div class="pillar-card-arrow">\n      <span>Learn more</span>\n      <svg><!-- arrow --></svg>\n    </div>\n  </div>\n</a>',
        css: '.pillar-card-title {\n  font-size: 20px;\n  font-weight: 600;\n  letter-spacing: -0.02em;\n  margin-bottom: 12px;\n}\n.pillar-card-desc {\n  font-size: 15px;\n  line-height: 1.6;\n  color: var(--muted);\n}\n.pillar-card-arrow {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 20px;\n  font-size: 13px;\n  color: var(--blue);\n}',
        fallback: '.glass-container {\n  background: rgba(30,30,35,0.95);\n}\n.glass-bg {\n  backdrop-filter: none;\n}'
      },
      'home-pillar-assets': {
        html: '<a href="compound-assets.html" class="glass-container">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-icon">\n      <svg><!-- layers --></svg>\n    </div>\n    <h3 class="pillar-card-title">Compound Asset Pipeline</h3>\n    <p class="pillar-card-desc">Assets are layered, interconnected\n      structures...</p>\n    <div class="pillar-card-arrow">\n      <span>Learn more</span>\n    </div>\n  </div>\n</a>',
        css: '/* Same as Spatial pillar ‚Äî uses .pillar-card-title,\n   .pillar-card-desc, .pillar-card-arrow */\n/* See Universal > Glass Container for glass styles */',
        fallback: '/* Same glass fallback applies */'
      },
      'home-pillar-world': {
        html: '<a href="world-building.html" class="glass-container">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-icon">\n      <svg><!-- network nodes --></svg>\n    </div>\n    <h3 class="pillar-card-title">World Building Neural Network</h3>\n    <p class="pillar-card-desc">A project-specific simulation layer\n      modeling the world...</p>\n    <div class="pillar-card-arrow">\n      <span>Learn more</span>\n    </div>\n  </div>\n</a>',
        css: '/* Same pillar card styles apply */\n/* See Universal > Glass Container */',
        fallback: '/* Same glass fallback applies */'
      },
      'home-footer': {
        html: '<footer class="footer">\n  <div class="container footer-inner">\n    <p class="footer-credit">Designed and engineered by\n      <strong>Aniket Bhatt</strong></p>\n    <p class="footer-role">Meta Creative Core &middot;\n      Production Design + XR</p>\n    <div class="footer-tech">\n      <span>Unreal Engine 5.7</span>\n      <span>Meta Quest 3</span>\n      <span>Meta OpenXR</span>\n      <span>Take Recorder</span>\n      <span>Perforce</span>\n    </div>\n  </div>\n</footer>',
        css: '.footer {\n  border-top: 1px solid rgba(255,255,255,0.08);\n  padding: 3rem 0 4rem;\n}\n.footer-inner {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n  text-align: center;\n}\n.footer-tech span {\n  font-family: var(--font-mono);\n  font-size: 11px;\n  color: oklch(0.55 0.01 260 / 30%);\n}',
        fallback: '/* No fallback needed ‚Äî no glass effects */'
      },
      'spatial-arch': {
        html: '<div class="sp-card">\n  <div class="sp-card-header">\n    <span class="sp-card-label">System Architecture</span>\n    <span class="sp-live"><span class="sp-live-dot"></span>LIVE</span>\n  </div>\n  <svg viewBox="0 0 800 280">\n    <!-- Quest 3 + CineCamera + UE5.7 bar -->\n  </svg>\n</div>',
        css: '.sp-card {\n  background: #242526;\n  border-radius: 20px;\n  border: 1px solid #3e4042;\n  padding: 32px;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.3),\n    0 8px 24px rgba(0,0,0,0.2);\n}',
        fallback: '/* Spatial page uses opaque backgrounds,\n   no backdrop-filter needed */'
      },
      'spatial-layers': {
        html: '<div class="sp-card">\n  <div class="sp-section-label">ARCHITECTURAL LAYERS</div>\n  <div class="sp-layers">\n    <div class="sp-layer">\n      <span class="sp-layer-num">1</span>\n      <div>\n        <div class="sp-layer-title">UE World</div>\n        <div class="sp-layer-desc">Core Unreal level...</div>\n      </div>\n    </div>\n    <!-- layers 2-5 -->\n  </div>\n</div>',
        css: '.sp-layer {\n  display: flex;\n  align-items: center;\n  padding: 14px 0;\n  border-bottom: 1px solid rgba(255,255,255,0.06);\n}\n.sp-layer-num {\n  font-size: 28px;\n  font-weight: 700;\n  color: #0082fb;\n  min-width: 48px;\n}',
        fallback: '/* No fallback needed ‚Äî opaque backgrounds */'
      },
      'spatial-card-take': {
        html: '<div class="sp-card sp-card-sm">\n  <div class="sp-card-icon" style="background:rgba(255,59,48,0.15);">\n    <span>&#9210;</span>\n  </div>\n  <div class="sp-card-title">Take Recorder</div>\n  <div class="sp-card-desc">Multi-track motion capture...</div>\n</div>',
        css: '.sp-card-sm {\n  padding: 24px;\n}\n.sp-card-icon {\n  width: 36px; height: 36px;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 12px;\n}',
        fallback: '/* No fallback needed */'
      },
      'spatial-card-role': {
        html: '<div class="sp-card sp-card-sm">\n  <div class="sp-card-icon" style="background:rgba(0,130,251,0.15);">\n    <span>&#128100;</span>\n  </div>\n  <div class="sp-card-title">VR Role System</div>\n  <div class="sp-card-desc">IVRRole interface...</div>\n</div>',
        css: '/* Same .sp-card-sm styles apply */',
        fallback: '/* No fallback needed */'
      },
      'spatial-card-export': {
        html: '<div class="sp-card sp-card-sm">\n  <div class="sp-card-icon" style="background:rgba(52,199,89,0.15);">\n    <span>&#128228;</span>\n  </div>\n  <div class="sp-card-title">Export Pipeline</div>\n  <div class="sp-card-desc">Level Sequence -> MRQ...</div>\n</div>',
        css: '/* Same .sp-card-sm styles apply */',
        fallback: '/* No fallback needed */'
      },
      'spatial-status': {
        html: '<div class="sp-card">\n  <div class="sp-card-header">\n    <span class="sp-card-label">Component Status</span>\n    <span class="sp-live"><span class="sp-live-dot"></span>LIVE</span>\n  </div>\n  <table class="sp-status-table">\n    <thead>\n      <tr><th>Component</th><th>Module</th>\n        <th>Status</th><th>Priority</th></tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>VR Pawn + Roles</td>\n        <td><span class="sp-module-tag">VRProduction</span></td>\n        <td><span class="sp-status-badge sp-in-progress">\n          In Progress</span></td>\n        <td class="sp-priority-high">High</td>\n      </tr>\n    </tbody>\n  </table>\n</div>',
        css: '.sp-status-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n.sp-status-table th {\n  font-size: 11px;\n  color: #8a8d91;\n  text-align: left;\n  padding: 8px 12px;\n}\n.sp-status-badge {\n  padding: 4px 12px;\n  border-radius: 20px;\n  font-size: 11px;\n}',
        fallback: '/* No fallback needed ‚Äî opaque backgrounds */'
      },
      'compound-layers': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-panel-header">\n      <span class="card-panel-label">Asset Layer Structure</span>\n    </div>\n    <svg viewBox="0 0 600 340">\n      <!-- 6 layer rows + Compound Asset box -->\n    </svg>\n  </div>\n</div>',
        css: '/* Uses glass-container glass-sm */\n/* SVG uses oklch() stroke colors:\n   Red:    oklch(0.60 0.22 25)   Metadata\n   Orange: oklch(0.72 0.16 60)   LOD\n   Teal:   oklch(0.65 0.12 195)  Lighting\n   Blue:   oklch(0.62 0.20 255)  Materials\n   Green:  oklch(0.68 0.16 145)  Collision\n*/',
        fallback: '.glass-container.glass-sm {\n  background: rgba(30,30,35,0.95);\n}'
      },
      'compound-comparison': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-panel-header">\n      <span class="card-panel-label">Traditional vs Compound</span>\n    </div>\n    <table class="data-table">\n      <thead><tr><th></th>\n        <th style="color:oklch(0.60 0.22 25)">Traditional</th>\n        <th style="color:oklch(0.68 0.16 145)">Compound</th>\n      </tr></thead>\n      <tbody>\n        <tr><td>Asset Update</td>\n          <td>Rebuild from scratch</td>\n          <td>Update single layer</td></tr>\n      </tbody>\n    </table>\n  </div>\n</div>',
        css: '.data-table {\n  width: 100%;\n  border-collapse: collapse;\n}\n.data-table th {\n  font-size: 13px;\n  text-align: left;\n  padding: 10px 16px;\n  border-bottom: 1px solid rgba(255,255,255,0.08);\n}\n.data-table td {\n  padding: 10px 16px;\n  font-size: 14px;\n  border-bottom: 1px solid rgba(255,255,255,0.04);\n}',
        fallback: '/* Same glass fallback applies */'
      },
      'compound-benefit-nd': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content" style="border-top:2px solid var(--blue);">\n    <h4 class="card-title">Non-Destructive</h4>\n    <p class="card-text">Edit any layer without affecting others.</p>\n  </div>\n</div>',
        css: '.card-title {\n  font-size: 15px;\n  font-weight: 600;\n  margin-bottom: 6px;\n}\n.card-text {\n  font-size: 13px;\n  color: var(--muted);\n  line-height: 1.5;\n}',
        fallback: '/* Same glass fallback */'
      },
      'compound-benefit-va': {
        html: '<!-- Same structure as Non-Destructive -->\n<!-- border-top: 2px solid var(--green) -->',
        css: '/* Same card-title / card-text styles */',
        fallback: '/* Same glass fallback */'
      },
      'compound-benefit-pr': {
        html: '<!-- Same structure as Non-Destructive -->\n<!-- border-top: 2px solid var(--orange) -->',
        css: '/* Same card-title / card-text styles */',
        fallback: '/* Same glass fallback */'
      },
      'world-network': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-panel-header">\n      <span class="card-panel-label">World State Network</span>\n      <div class="live-indicator">\n        <div class="live-dot"></div>\n        <span class="live-label">LIVE</span>\n      </div>\n    </div>\n    <svg viewBox="0 0 760 260">\n      <!-- Location nodes: Mangrove, Caldera, Encampment,\n           Mycelium, Tidal Canopy -->\n      <!-- Processing: World State, Story Events -->\n      <!-- AI: DINOv2, PCG -->\n      <!-- Output: Live World -->\n      <!-- Animated connections with stroke-dasharray -->\n    </svg>\n  </div>\n</div>',
        css: '/* SVG node colors:\n   Mangrove:    #4dd0e1 (cyan)\n   Caldera:     #ef5350 (red)\n   Encampment:  #66bb6a (green)\n   Mycelium:    #42a5f5 (blue)\n   Tidal:       #ffa726 (orange)\n   World State: #4dd0e1\n   Story Events:#ef5350\n   DINOv2:      #42a5f5\n   PCG:         #66bb6a\n   Live World:  #ffa726\n*/\n/* Connection lines use stroke-dasharray: 3 3\n   with animated stroke-dashoffset */\n/* Data particles use <animateMotion> */',
        fallback: '/* SVG animations work in all browsers */\n/* Glass container fallback applies */'
      },
      'world-card-biomes': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-icon"><!-- layers SVG --></div>\n    <h4 class="card-title">Procedural Content Generation</h4>\n    <p class="card-text">UE5 PCG framework generates\n      environments from rule sets...</p>\n  </div>\n</div>',
        css: '/* Uses glass-sm + card-title + card-text */',
        fallback: '/* Same glass fallback */'
      },
      'world-card-memory': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-icon"><!-- clock SVG --></div>\n    <h4 class="card-title">Persistent World State</h4>\n    <p class="card-text">Every location maintains state\n      across production sessions...</p>\n  </div>\n</div>',
        css: '/* Uses glass-sm + card-title + card-text */',
        fallback: '/* Same glass fallback */'
      },
      'world-card-ai': {
        html: '<div class="glass-container glass-sm">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <div class="card-icon"><!-- grid SVG --></div>\n    <h4 class="card-title">Modular Biome System</h4>\n    <p class="card-text">Biomes are composable modules...</p>\n  </div>\n</div>',
        css: '/* Uses glass-sm + card-title + card-text */',
        fallback: '/* Same glass fallback */'
      },
      'world-closing': {
        html: '<div class="glass-container glass-sm closing">\n  <div class="glass-bg"></div>\n  <div class="glass-content">\n    <p>The world is not a backdrop. It is a\n      <strong>character</strong>. The initial\n      proof-of-concept is a simulation...</p>\n  </div>\n</div>',
        css: '.closing .glass-content {\n  border-left: 3px solid oklch(0.65 0.12 195);\n}\n.closing p {\n  font-size: 20px;\n  font-style: italic;\n  line-height: 1.8;\n  color: var(--muted);\n}',
        fallback: '.closing {\n  background: rgba(30,30,35,0.95);\n}'
      }
    };

    // ============================================================
    // HELPERS
    // ============================================================
    function q(sel) { return document.querySelector(sel); }
    function qa(sel) { return document.querySelectorAll(sel); }
    function applyAll(sel, prop, val) {
      qa(sel).forEach(function(el) { el.style[prop] = val; });
    }

    // ============================================================
    // RENDER SIDEBAR PANEL
    // ============================================================
    function renderPanel(compId) {
      var def = PROPS[compId];
      if (!def) return '';
      var html = '';
      def.groups.forEach(function(group) {
        var badgeClass = group.badge === 'universal' ? 'badge-universal' : 'badge-instance';
        html += '<div class="prop-group">';
        html += '<div class="prop-group-header" onclick="toggleGroup(this)">';
        html += '<span><span class="prop-group-title">' + group.title + '</span> <span class="prop-group-badge ' + badgeClass + '">' + group.badge.toUpperCase() + '</span></span>';
        html += '<span class="prop-group-chevron">‚ñº</span>';
        html += '</div>';
        html += '<div class="prop-group-body">';
        group.props.forEach(function(p) {
          if (p.type === 'slider') {
            var step = p.step || 1;
            html += '<div class="prop-row">';
            html += '<span class="prop-label">' + p.label + '</span>';
            html += '<input type="range" class="prop-slider" min="' + p.min + '" max="' + p.max + '" step="' + step + '" value="' + p.value + '" data-target="' + p.target + '" oninput="syncNum(this)">';
            html += '<input type="number" class="prop-number" min="' + p.min + '" max="' + p.max + '" step="' + step + '" value="' + p.value + '" data-target="' + p.target + '" oninput="syncSlider(this)">';
            html += '<span class="prop-unit">' + p.unit + '</span>';
            html += '</div>';
          } else if (p.type === 'color') {
            html += '<div class="prop-row">';
            html += '<span class="prop-label">' + p.label + '</span>';
            html += '<input type="color" class="prop-color" value="' + p.value + '" data-target="' + p.target + '" oninput="onPropChange(this)">';
            html += '<span class="prop-color-label">' + p.value + '</span>';
            html += '</div>';
          } else if (p.type === 'text') {
            html += '<div class="prop-row">';
            html += '<span class="prop-label">' + p.label + '</span>';
            html += '<input type="text" class="prop-text" value="' + escHtml(p.value) + '" data-target="' + p.target + '" oninput="onPropChange(this)">';
            html += '</div>';
          }
        });
        html += '</div></div>';
      });

      // Add code editor tabs if snippets exist
      var snippets = CODE_SNIPPETS[compId];
      if (snippets) {
        html += '<div class="code-section">';
        html += '<div class="code-section-title">CODE</div>';
        html += '<div class="code-tabs">';
        html += '<button class="code-tab active" onclick="switchCodeTab(this,\'' + compId + '\',\'html\')">HTML</button>';
        html += '<button class="code-tab" onclick="switchCodeTab(this,\'' + compId + '\',\'css\')">CSS</button>';
        html += '<button class="code-tab" onclick="switchCodeTab(this,\'' + compId + '\',\'fallback\')">Fallback</button>';
        html += '</div>';
        html += '<textarea class="code-editor" id="code-editor-' + compId + '" spellcheck="false">' + escHtml(snippets.html) + '</textarea>';
        html += '</div>';
      }

      return html;
    }

    // Code tab switching
    window.switchCodeTab = function(btn, compId, tab) {
      var tabs = btn.parentElement.querySelectorAll('.code-tab');
      tabs.forEach(function(t) { t.classList.remove('active'); });
      btn.classList.add('active');
      var editor = document.getElementById('code-editor-' + compId);
      var snippets = CODE_SNIPPETS[compId];
      if (editor && snippets) {
        editor.value = snippets[tab] || '';
      }
    };

    function escHtml(s) { return s.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

    // ============================================================
    // COMPONENT SELECTION
    // ============================================================
    window.selectComp = function(wrap) {
      qa('.component-wrap').forEach(function(w) { w.classList.remove('selected'); });
      wrap.classList.add('selected');
      var compId = wrap.getAttribute('data-comp');
      currentComp = compId;
      var sidebar = document.getElementById('sidebar-content');
      document.getElementById('empty-state').style.display = 'none';
      document.getElementById('close-btn').style.display = 'block';
      sidebar.innerHTML = '<div id="empty-state" style="display:none"></div>' + renderPanel(compId);
    };

    document.getElementById('close-btn').addEventListener('click', function() {
      qa('.component-wrap').forEach(function(w) { w.classList.remove('selected'); });
      currentComp = null;
      document.getElementById('sidebar-content').innerHTML = '<div class="sidebar-empty" id="empty-state">Click any component<br>in the preview to inspect<br>and edit its properties</div>';
      this.style.display = 'none';
    });

    // ============================================================
    // SYNC SLIDER ‚Üî NUMBER
    // ============================================================
    window.syncNum = function(slider) {
      var target = slider.getAttribute('data-target');
      var row = slider.parentElement;
      var num = row.querySelector('.prop-number');
      if (num) num.value = slider.value;
      triggerApply(target, parseFloat(slider.value));
    };

    window.syncSlider = function(num) {
      var target = num.getAttribute('data-target');
      var row = num.parentElement;
      var slider = row.querySelector('.prop-slider');
      if (slider) slider.value = num.value;
      triggerApply(target, parseFloat(num.value));
    };

    // Scroll wheel on number inputs
    document.addEventListener('wheel', function(e) {
      if (e.target.classList.contains('prop-number')) {
        e.preventDefault();
        var input = e.target;
        var step = parseFloat(input.step) || 1;
        var speed = Math.abs(e.deltaY);
        var mult = speed > 100 ? 10 : speed > 50 ? 5 : 1;
        var delta = e.deltaY < 0 ? step * mult : -step * mult;
        var newVal = Math.round((parseFloat(input.value) + delta) * 100) / 100;
        var min = parseFloat(input.min);
        var max = parseFloat(input.max);
        if (!isNaN(min)) newVal = Math.max(min, newVal);
        if (!isNaN(max)) newVal = Math.min(max, newVal);
        input.value = newVal;
        var row = input.parentElement;
        var slider = row.querySelector('.prop-slider');
        if (slider) slider.value = newVal;
        triggerApply(input.getAttribute('data-target'), newVal);
      }
    }, { passive: false });

    window.onPropChange = function(el) {
      var target = el.getAttribute('data-target');
      if (el.type === 'color') {
        var label = el.parentElement.querySelector('.prop-color-label');
        if (label) label.textContent = el.value;
      }
      triggerApply(target, el.value);
    };

    // ============================================================
    // APPLY MAP ‚Äî Central mapping from target ‚Üí DOM update
    // Covers every property that doesn't have an inline apply()
    // Format: target: { sel: selector, prop: cssProperty }
    //    or   target: { fn: function(v) { ... } }
    // ============================================================
    var APPLY_MAP = {
      // --- HOME HERO ---
      'home-hero-badge-size':   { fn: function(v) { var el = q('#preview-home-hero .p-hero-badge'); if(el) el.style.fontSize = v + 'px'; } },
      'home-hero-badge-weight': { fn: function(v) { var el = q('#preview-home-hero .p-hero-badge'); if(el) el.style.fontWeight = v; } },
      'home-hero-sub-size':     { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'home-hero-sub-lh':       { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(2)'); if(el) el.style.lineHeight = v; } },
      'home-hero-meta-size':    { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'home-hero-max-w':        { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(2)'); if(el) el.style.maxWidth = v + 'px'; } },
      'home-hero-sub-color':    { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(2)'); if(el) el.style.color = v; } },
      'home-hero-sub-op':       { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(2)'); if(el) el.style.opacity = v/100; } },
      'home-hero-meta-op':      { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(3)'); if(el) el.style.opacity = v/100; } },
      'home-hero-badge-text':   { fn: function(v) { var el = q('#preview-home-hero .p-hero-badge'); if(el) el.textContent = v; } },
      'home-hero-sub-text':     { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(2)'); if(el) el.textContent = v; } },
      'home-hero-author':       { fn: function(v) { var el = q('#preview-home-hero > div > div:nth-child(3) > span:first-child'); if(el) el.textContent = v; } },

      // --- HOME PILLAR: SPATIAL ---
      'hp-s-border-op':    { fn: function(v) { var el = q('#preview-pillar-spatial'); if(el) el.style.borderColor = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hp-s-icon-bg-op':   { fn: function(v) { var el = q('#preview-pillar-spatial .p-icon-circle'); if(el) el.style.background = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hp-s-icon-size':    { fn: function(v) { var el = q('#preview-pillar-spatial .p-icon-circle'); if(el) { el.style.width = v + 'px'; el.style.height = v + 'px'; } } },
      'hp-s-icon-radius':  { fn: function(v) { var el = q('#preview-pillar-spatial .p-icon-circle'); if(el) el.style.borderRadius = v + 'px'; } },
      'hp-s-title-size':   { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-s-title-weight': { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(2)'); if(el) el.style.fontWeight = v; } },
      'hp-s-title-ls':     { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(2)'); if(el) el.style.letterSpacing = v + 'em'; } },
      'hp-s-desc-size':    { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-s-desc-lh':      { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(3)'); if(el) el.style.lineHeight = v; } },
      'hp-s-desc-op':      { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(3)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hp-s-arrow-size':   { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(4)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-s-arrow-color':  { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(4)'); if(el) el.style.color = v; } },
      'hp-s-title':        { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(2)'); if(el) el.textContent = v; } },
      'hp-s-desc':         { fn: function(v) { var el = q('#preview-pillar-spatial > div:nth-child(3)'); if(el) el.textContent = v; } },

      // --- HOME PILLAR: ASSETS ---
      'hp-a-title-size':   { fn: function(v) { var el = q('#preview-pillar-assets > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-a-desc-size':    { fn: function(v) { var el = q('#preview-pillar-assets > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-a-desc-op':      { fn: function(v) { var el = q('#preview-pillar-assets > div:nth-child(3)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hp-a-arrow-color':  { fn: function(v) { var el = q('#preview-pillar-assets > div:nth-child(4)'); if(el) el.style.color = v; } },
      'hp-a-title':        { fn: function(v) { var el = q('#preview-pillar-assets > div:nth-child(2)'); if(el) el.textContent = v; } },
      'hp-a-desc':         { fn: function(v) { var el = q('#preview-pillar-assets > div:nth-child(3)'); if(el) el.textContent = v; } },

      // --- HOME PILLAR: WORLD ---
      'hp-w-title-size':   { fn: function(v) { var el = q('#preview-pillar-world > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-w-desc-size':    { fn: function(v) { var el = q('#preview-pillar-world > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'hp-w-desc-op':      { fn: function(v) { var el = q('#preview-pillar-world > div:nth-child(3)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hp-w-arrow-color':  { fn: function(v) { var el = q('#preview-pillar-world > div:nth-child(4)'); if(el) el.style.color = v; } },
      'hp-w-title':        { fn: function(v) { var el = q('#preview-pillar-world > div:nth-child(2)'); if(el) el.textContent = v; } },
      'hp-w-desc':         { fn: function(v) { var el = q('#preview-pillar-world > div:nth-child(3)'); if(el) el.textContent = v; } },

      // --- HOME FOOTER ---
      'hf-border-op':      { fn: function(v) { var el = q('#preview-home-footer'); if(el) el.style.borderTopColor = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hf-pad-top':        { fn: function(v) { var el = q('#preview-home-footer'); if(el) el.style.paddingTop = v + 'px'; } },
      'hf-pad-bottom':     { fn: function(v) { var el = q('#preview-home-footer'); if(el) el.style.paddingBottom = v + 'px'; } },
      'hf-gap':            { fn: function(v) { var el = q('#preview-home-footer'); if(el) el.style.gap = v + 'px'; } },
      'hf-credit-size':    { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(1)'); if(el) el.style.fontSize = v + 'px'; } },
      'hf-credit-op':      { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(1)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hf-role-size':      { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'hf-role-op':        { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(2)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'hf-tech-font':      { fn: function(v) { qa('#preview-home-footer > div:nth-child(3) > span').forEach(function(s) { s.style.fontSize = v + 'px'; }); } },
      'hf-tech-op':        { fn: function(v) { qa('#preview-home-footer > div:nth-child(3) > span').forEach(function(s) { s.style.color = 'rgba(255,255,255,' + (v/100) + ')'; }); } },
      'hf-tech-gap':       { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(3)'); if(el) el.style.gap = v + 'px'; } },
      'hf-credit-name':    { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(1) strong'); if(el) el.textContent = v; } },
      'hf-role-text':      { fn: function(v) { var el = q('#preview-home-footer > div:nth-child(2)'); if(el) el.textContent = v; } },

      // --- SPATIAL: ARCHITECTURE SVG ---
      // SVG elements use setAttribute, not style
      'sa-stroke-op':      { fn: function(v) { qa('#preview-spatial-arch svg > rect:not(:last-child)').forEach(function(r) { r.setAttribute('stroke', 'rgba(255,255,255,' + (v/100) + ')'); }); } },
      'sa-stroke-w':       { fn: function(v) { qa('#preview-spatial-arch svg > rect:not(:last-child)').forEach(function(r) { r.setAttribute('stroke-width', v); }); } },
      'sa-box-radius':     { fn: function(v) { qa('#preview-spatial-arch svg > rect').forEach(function(r) { r.setAttribute('rx', v); }); } },
      'sa-lens-op':        { fn: function(v) { qa('#preview-spatial-arch svg circle').forEach(function(c) { c.setAttribute('stroke', 'rgba(255,255,255,' + (v/100) + ')'); }); } },
      'sa-dot-green':      { fn: function(v) { var dots = qa('#preview-spatial-arch svg circle[fill]'); if(dots[0]) dots[0].setAttribute('fill', v); } },
      'sa-dot-red':        { fn: function(v) { var dots = qa('#preview-spatial-arch svg circle[fill]'); if(dots[1]) dots[1].setAttribute('fill', v); } },
      'sa-dot-r':          { fn: function(v) { qa('#preview-spatial-arch svg circle[fill]').forEach(function(c) { c.setAttribute('r', v); }); } },
      'sa-wifi-op':        { fn: function(v) { qa('#preview-spatial-arch svg path').forEach(function(p) { p.setAttribute('stroke', 'rgba(255,255,255,' + (v/100) + ')'); }); } },
      'sa-wifi-w':         { fn: function(v) { qa('#preview-spatial-arch svg path').forEach(function(p) { p.setAttribute('stroke-width', v); }); } },
      'sa-label-size':     { fn: function(v) { qa('#preview-spatial-arch svg text[font-size="14"]').forEach(function(t) { t.setAttribute('font-size', v); }); } },
      'sa-label-op':       { fn: function(v) { qa('#preview-spatial-arch svg text[font-size="14"]').forEach(function(t) { t.setAttribute('fill', 'rgba(255,255,255,' + (v/100) + ')'); }); } },
      'sa-sublabel-size':  { fn: function(v) { qa('#preview-spatial-arch svg text[font-size="11"]').forEach(function(t) { t.setAttribute('font-size', v); }); } },
      'sa-sublabel-op':    { fn: function(v) { qa('#preview-spatial-arch svg text[font-size="11"]').forEach(function(t) { t.setAttribute('fill', 'rgba(255,255,255,' + (v/100) + ')'); }); } },
      'sa-wifi-label-size':{ fn: function(v) { var t = qa('#preview-spatial-arch svg text'); if(t[4]) t[4].setAttribute('font-size', v); } },
      'sa-bar-h':          { fn: function(v) { var r = q('#preview-spatial-arch svg > rect:last-child'); if(r) r.setAttribute('height', v); } },
      'sa-bar-radius':     { fn: function(v) { var r = q('#preview-spatial-arch svg > rect:last-child'); if(r) r.setAttribute('rx', v); } },
      'sa-bar-bg-op':      { fn: function(v) { var r = q('#preview-spatial-arch svg > rect:last-child'); if(r) r.setAttribute('fill', 'rgba(255,255,255,' + (v/100) + ')'); } },
      'sa-bar-border-op':  { fn: function(v) { var r = q('#preview-spatial-arch svg > rect:last-child'); if(r) r.setAttribute('stroke', 'rgba(255,255,255,' + (v/100) + ')'); } },
      'sa-bar-text-size':  { fn: function(v) { var t = q('#preview-spatial-arch svg text:last-child'); if(t) t.setAttribute('font-size', v); } },
      'sa-ue-text':        { fn: function(v) { var t = q('#preview-spatial-arch svg text:last-child'); if(t) t.textContent = v; } },

      // --- SPATIAL: FIVE LAYERS ---
      'sl-num-bg':         { fn: function(v) { qa('#layers-list .p-layer-num').forEach(function(n) { n.style.background = v; }); } },
      'sl-num-size':       { fn: function(v) { qa('#layers-list .p-layer-num').forEach(function(n) { n.style.width = v + 'px'; n.style.height = v + 'px'; n.style.fontSize = (v * 0.5) + 'px'; }); } },
      'sl-title-size':     { fn: function(v) { qa('#layers-list > div > div > div:first-child').forEach(function(t) { t.style.fontSize = v + 'px'; }); } },
      'sl-desc-size':      { fn: function(v) { qa('#layers-list > div > div > div:last-child').forEach(function(d) { d.style.fontSize = v + 'px'; }); } },
      'sl-row-pad':        { fn: function(v) { qa('#layers-list > div').forEach(function(r) { r.style.paddingTop = v + 'px'; r.style.paddingBottom = v + 'px'; }); } },
      'sl-divider-op':     { fn: function(v) { qa('#layers-list > div').forEach(function(r) { r.style.borderBottomColor = 'rgba(255,255,255,' + (v/100) + ')'; }); } },

      // --- SPATIAL: TAKE RECORDER CARD ---
      'sct-icon':          { fn: function(v) { var el = q('#preview-card-take .p-icon-circle'); if(el) el.textContent = v; } },
      'sct-icon-color':    { fn: function(v) { var el = q('#preview-card-take .p-icon-circle'); if(el) el.style.background = v + '26'; } },
      'sct-title':         { fn: function(v) { var el = q('#preview-card-take > div:nth-child(2)'); if(el) el.textContent = v; } },
      'sct-desc':          { fn: function(v) { var el = q('#preview-card-take > div:nth-child(3)'); if(el) el.textContent = v; } },
      'sct-title-size':    { fn: function(v) { var el = q('#preview-card-take > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'sct-desc-size':     { fn: function(v) { var el = q('#preview-card-take > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },

      // --- SPATIAL: VR ROLE CARD ---
      'scr-icon-color':    { fn: function(v) { var el = q('#preview-card-role .p-icon-circle'); if(el) el.style.background = v + '26'; } },
      'scr-title':         { fn: function(v) { var el = q('#preview-card-role > div:nth-child(2)'); if(el) el.textContent = v; } },
      'scr-desc':          { fn: function(v) { var el = q('#preview-card-role > div:nth-child(3)'); if(el) el.textContent = v; } },

      // --- SPATIAL: EXPORT CARD ---
      'sce-icon-color':    { fn: function(v) { var el = q('#preview-card-export .p-icon-circle'); if(el) el.style.background = v + '26'; } },
      'sce-title':         { fn: function(v) { var el = q('#preview-card-export > div:nth-child(2)'); if(el) el.textContent = v; } },
      'sce-desc':          { fn: function(v) { var el = q('#preview-card-export > div:nth-child(3)'); if(el) el.textContent = v; } },

      // --- SPATIAL: STATUS TABLE ---
      'ss-badge-radius':   { fn: function(v) { qa('#preview-spatial-status .p-status-badge').forEach(function(b) { b.style.borderRadius = v + 'px'; }); } },
      'ss-badge-font':     { fn: function(v) { qa('#preview-spatial-status .p-status-badge').forEach(function(b) { b.style.fontSize = v + 'px'; }); } },
      'ss-header-size':    { fn: function(v) { qa('#preview-spatial-status th').forEach(function(h) { h.style.fontSize = v + 'px'; }); } },
      'ss-cell-size':      { fn: function(v) { qa('#preview-spatial-status td').forEach(function(c) { c.style.fontSize = v + 'px'; }); } },
      'ss-row-pad':        { fn: function(v) { qa('#preview-spatial-status td, #preview-spatial-status th').forEach(function(c) { c.style.paddingTop = v + 'px'; c.style.paddingBottom = v + 'px'; }); } },
      'ss-high-color':     { fn: function(v) { qa('#preview-spatial-status td:nth-child(4)').forEach(function(c) { if(c.textContent.trim() === 'High') c.style.color = v; }); } },
      'ss-med-color':      { fn: function(v) { qa('#preview-spatial-status td:nth-child(4)').forEach(function(c) { if(c.textContent.trim() === 'Medium') c.style.color = v; }); } },

      // --- COMPOUND: ASSET LAYERS ---
      'cl-row-pad':        { fn: function(v) { qa('#asset-layers-stack .p-asset-layer').forEach(function(l) { l.style.padding = v + 'px'; }); } },
      'cl-row-radius':     { fn: function(v) { qa('#asset-layers-stack .p-asset-layer').forEach(function(l) { l.style.borderRadius = v + 'px'; }); } },
      'cl-font':           { fn: function(v) { qa('#asset-layers-stack .p-asset-layer').forEach(function(l) { l.style.fontSize = v + 'px'; }); } },
      'cl-spacing':        { fn: function(v) { qa('#asset-layers-stack .p-asset-layer').forEach(function(l) { l.style.marginBottom = v + 'px'; }); } },
      'cl-border-w':       { fn: function(v) { qa('#asset-layers-stack .p-asset-layer').forEach(function(l) { l.style.borderLeftWidth = v + 'px'; }); } },
      'cl-color-1':        { fn: function(v) { var l = qa('#asset-layers-stack .p-asset-layer'); if(l[0]) { l[0].style.borderLeftColor = v; l[0].style.color = v; } } },
      'cl-color-2':        { fn: function(v) { var l = qa('#asset-layers-stack .p-asset-layer'); if(l[1]) { l[1].style.borderLeftColor = v; l[1].style.color = v; } } },
      'cl-color-3':        { fn: function(v) { var l = qa('#asset-layers-stack .p-asset-layer'); if(l[2]) { l[2].style.borderLeftColor = v; l[2].style.color = v; } } },
      'cl-color-4':        { fn: function(v) { var l = qa('#asset-layers-stack .p-asset-layer'); if(l[3]) { l[3].style.borderLeftColor = v; l[3].style.color = v; } } },
      'cl-color-5':        { fn: function(v) { var l = qa('#asset-layers-stack .p-asset-layer'); if(l[4]) { l[4].style.borderLeftColor = v; l[4].style.color = v; } } },
      'cl-gap':            { fn: function(v) { var el = q('#asset-layers-stack'); if(el) el.style.gap = v + 'px'; } },

      // --- COMPOUND: COMPARISON TABLE ---
      'cc-header-size':    { fn: function(v) { qa('#preview-compound-comparison th').forEach(function(h) { h.style.fontSize = v + 'px'; }); } },
      'cc-header-pad':     { fn: function(v) { qa('#preview-compound-comparison th').forEach(function(h) { h.style.padding = v + 'px'; }); } },
      'cc-trad-color':     { fn: function(v) { var ths = qa('#preview-compound-comparison th'); if(ths[1]) ths[1].style.color = v; } },
      'cc-comp-color':     { fn: function(v) { var ths = qa('#preview-compound-comparison th'); if(ths[2]) ths[2].style.color = v; } },
      'cc-cell-size':      { fn: function(v) { qa('#preview-compound-comparison td').forEach(function(c) { c.style.fontSize = v + 'px'; }); } },
      'cc-cell-pad':       { fn: function(v) { qa('#preview-compound-comparison td').forEach(function(c) { c.style.padding = v + 'px'; }); } },
      'cc-label-size':     { fn: function(v) { qa('#preview-compound-comparison td:first-child').forEach(function(c) { c.style.fontSize = v + 'px'; }); } },
      'cc-label-op':       { fn: function(v) { qa('#preview-compound-comparison td:first-child').forEach(function(c) { c.style.color = 'rgba(255,255,255,' + (v/100) + ')'; }); } },
      'cc-trad-op':        { fn: function(v) { qa('#preview-compound-comparison td:nth-child(2)').forEach(function(c) { c.style.color = 'rgba(255,255,255,' + (v/100) + ')'; }); } },
      'cc-comp-op':        { fn: function(v) { qa('#preview-compound-comparison td:nth-child(3)').forEach(function(c) { c.style.color = 'rgba(255,255,255,' + (v/100) + ')'; }); } },
      'cc-divider-op':     { fn: function(v) { qa('#preview-compound-comparison tr').forEach(function(r) { r.style.borderBottomColor = 'rgba(255,255,255,' + (v/100) + ')'; }); } },

      // --- COMPOUND: BENEFIT CARDS (use parent .component-wrap to find the right card) ---
      'cb1-radius':        { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm'); if(el) el.style.borderRadius = v + 'px'; } },
      'cb1-padding':       { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm'); if(el) el.style.padding = v + 'px'; } },
      'cb1-accent':        { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm'); if(el) el.style.borderTopColor = v; } },
      'cb1-border-w':      { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm'); if(el) el.style.borderTopWidth = v + 'px'; } },
      'cb1-title-size':    { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm > div:first-child'); if(el) el.style.fontSize = v + 'px'; } },
      'cb1-desc-size':     { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm > div:last-child'); if(el) el.style.fontSize = v + 'px'; } },
      'cb1-desc-op':       { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm > div:last-child'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },
      'cb1-title':         { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm > div:first-child'); if(el) el.textContent = v; } },
      'cb1-desc':          { fn: function(v) { var el = q('[data-comp="compound-benefit-nd"] .p-glass-sm > div:last-child'); if(el) el.textContent = v; } },

      'cb2-radius':        { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm'); if(el) el.style.borderRadius = v + 'px'; } },
      'cb2-padding':       { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm'); if(el) el.style.padding = v + 'px'; } },
      'cb2-accent':        { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm'); if(el) el.style.borderTopColor = v; } },
      'cb2-border-w':      { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm'); if(el) el.style.borderTopWidth = v + 'px'; } },
      'cb2-title-size':    { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm > div:first-child'); if(el) el.style.fontSize = v + 'px'; } },
      'cb2-desc-size':     { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm > div:last-child'); if(el) el.style.fontSize = v + 'px'; } },
      'cb2-title':         { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm > div:first-child'); if(el) el.textContent = v; } },
      'cb2-desc':          { fn: function(v) { var el = q('[data-comp="compound-benefit-va"] .p-glass-sm > div:last-child'); if(el) el.textContent = v; } },

      'cb3-radius':        { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm'); if(el) el.style.borderRadius = v + 'px'; } },
      'cb3-padding':       { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm'); if(el) el.style.padding = v + 'px'; } },
      'cb3-accent':        { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm'); if(el) el.style.borderTopColor = v; } },
      'cb3-border-w':      { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm'); if(el) el.style.borderTopWidth = v + 'px'; } },
      'cb3-title-size':    { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm > div:first-child'); if(el) el.style.fontSize = v + 'px'; } },
      'cb3-desc-size':     { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm > div:last-child'); if(el) el.style.fontSize = v + 'px'; } },
      'cb3-title':         { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm > div:first-child'); if(el) el.textContent = v; } },
      'cb3-desc':          { fn: function(v) { var el = q('[data-comp="compound-benefit-pr"] .p-glass-sm > div:last-child'); if(el) el.textContent = v; } },

      // --- WORLD: NETWORK NODE COLORS ---
      // Location nodes in preview: Mangrove (index 0), Encampment (index 1)
      'wn-mangrove-color': { fn: function(v) { var nodes = qa('#preview-world-network > div:nth-child(2) > div:nth-child(1) > div'); if(nodes[0]) { nodes[0].style.borderColor = v; var sp = nodes[0].querySelector('span'); if(sp) sp.style.color = v; } } },
      'wn-encampment-color':{ fn: function(v) { var nodes = qa('#preview-world-network > div:nth-child(2) > div:nth-child(2) > div'); if(nodes[0]) { nodes[0].style.borderColor = v; var sp = nodes[0].querySelector('span'); if(sp) sp.style.color = v; } } },
      'wn-loc-radius':     { fn: function(v) { var d = v * 2; qa('#preview-world-network > div:nth-child(2) > div > div').forEach(function(n, i) { if(i < 2 || !n.querySelector('span')) return; n.style.width = d + 'px'; n.style.height = d + 'px'; }); var locs = qa('#preview-world-network > div:nth-child(2) > div:nth-child(1) > div, #preview-world-network > div:nth-child(2) > div:nth-child(2) > div'); locs.forEach(function(n) { n.style.width = d + 'px'; n.style.height = d + 'px'; }); } },
      'wn-loc-font':       { fn: function(v) { qa('#preview-world-network > div:nth-child(2) > div:nth-child(1) span, #preview-world-network > div:nth-child(2) > div:nth-child(2) span').forEach(function(s) { s.style.fontSize = v + 'px'; }); } },
      // World State (processing) node
      'wn-state-color':    { fn: function(v) { var n = q('#preview-world-network > div:nth-child(2) > div:nth-child(4) > div'); if(n) { n.style.borderColor = v; var sp = n.querySelector('span'); if(sp) sp.style.color = v; } } },
      'wn-proc-radius':    { fn: function(v) { var d = v * 2; var n = q('#preview-world-network > div:nth-child(2) > div:nth-child(4) > div'); if(n) { n.style.width = d + 'px'; n.style.height = d + 'px'; } } },
      'wn-proc-font':      { fn: function(v) { var sp = q('#preview-world-network > div:nth-child(2) > div:nth-child(4) > div > span'); if(sp) sp.style.fontSize = v + 'px'; } },
      // AI node (DINOv2)
      'wn-dino-color':     { fn: function(v) { var n = q('#preview-world-network > div:nth-child(2) > div:nth-child(6) > div'); if(n) { n.style.borderColor = v; var sp = n.querySelector('span'); if(sp) sp.style.color = v; } } },
      'wn-ai-radius':      { fn: function(v) { var d = v * 2; var n = q('#preview-world-network > div:nth-child(2) > div:nth-child(6) > div'); if(n) { n.style.width = d + 'px'; n.style.height = d + 'px'; } } },
      'wn-ai-font':        { fn: function(v) { var sp = q('#preview-world-network > div:nth-child(2) > div:nth-child(6) > div > span'); if(sp) sp.style.fontSize = v + 'px'; } },
      'wn-ai-sub-font':    { fn: function(v) { var sub = q('#preview-world-network > div:nth-child(2) > div:nth-child(6) > div:last-child'); if(sub && sub.style) sub.style.fontSize = v + 'px'; } },
      // Output node (not in simplified preview, but map anyway)
      'wn-output-color':   { fn: function(v) { /* Output node not in simplified preview */ } },

      // --- WORLD: SYSTEM CARDS ---
      // Biomes card
      'wcb-radius':        { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm'); if(el) el.style.borderRadius = v + 'px'; } },
      'wcb-padding':       { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm'); if(el) el.style.padding = v + 'px'; } },
      'wcb-icon-bg-op':    { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-icon-circle'); if(el) el.style.opacity = v/100; } },
      'wcb-icon-size':     { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-icon-circle'); if(el) { el.style.width = v + 'px'; el.style.height = v + 'px'; } } },
      'wcb-icon-radius':   { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-icon-circle'); if(el) el.style.borderRadius = v + 'px'; } },
      'wcb-color':         { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-icon-circle'); if(el) el.style.background = v + '26'; } },
      'wcb-title':         { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm > div:nth-child(2)'); if(el) el.textContent = v; } },
      'wcb-desc':          { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm > div:nth-child(3)'); if(el) el.textContent = v; } },
      'wcb-title-size':    { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'wcb-desc-size':     { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'wcb-desc-op':       { fn: function(v) { var el = q('[data-comp="world-card-biomes"] .p-glass-sm > div:nth-child(3)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },

      // Memory card
      'wcm-radius':        { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm'); if(el) el.style.borderRadius = v + 'px'; } },
      'wcm-padding':       { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm'); if(el) el.style.padding = v + 'px'; } },
      'wcm-icon-bg-op':    { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-icon-circle'); if(el) el.style.opacity = v/100; } },
      'wcm-icon-size':     { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-icon-circle'); if(el) { el.style.width = v + 'px'; el.style.height = v + 'px'; } } },
      'wcm-icon-radius':   { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-icon-circle'); if(el) el.style.borderRadius = v + 'px'; } },
      'wcm-color':         { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-icon-circle'); if(el) el.style.background = v + '26'; } },
      'wcm-title':         { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm > div:nth-child(2)'); if(el) el.textContent = v; } },
      'wcm-desc':          { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm > div:nth-child(3)'); if(el) el.textContent = v; } },
      'wcm-title-size':    { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'wcm-desc-size':     { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'wcm-desc-op':       { fn: function(v) { var el = q('[data-comp="world-card-memory"] .p-glass-sm > div:nth-child(3)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },

      // AI card
      'wca-radius':        { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm'); if(el) el.style.borderRadius = v + 'px'; } },
      'wca-padding':       { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm'); if(el) el.style.padding = v + 'px'; } },
      'wca-icon-bg-op':    { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-icon-circle'); if(el) el.style.opacity = v/100; } },
      'wca-icon-size':     { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-icon-circle'); if(el) { el.style.width = v + 'px'; el.style.height = v + 'px'; } } },
      'wca-icon-radius':   { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-icon-circle'); if(el) el.style.borderRadius = v + 'px'; } },
      'wca-color':         { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-icon-circle'); if(el) el.style.background = v + '26'; } },
      'wca-title':         { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm > div:nth-child(2)'); if(el) el.textContent = v; } },
      'wca-desc':          { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm > div:nth-child(3)'); if(el) el.textContent = v; } },
      'wca-title-size':    { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm > div:nth-child(2)'); if(el) el.style.fontSize = v + 'px'; } },
      'wca-desc-size':     { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm > div:nth-child(3)'); if(el) el.style.fontSize = v + 'px'; } },
      'wca-desc-op':       { fn: function(v) { var el = q('[data-comp="world-card-ai"] .p-glass-sm > div:nth-child(3)'); if(el) el.style.color = 'rgba(255,255,255,' + (v/100) + ')'; } },

      // --- WORLD: CLOSING QUOTE ---
      'wc-border-color':   { fn: function(v) { var el = q('#preview-world-closing'); if(el) el.style.borderLeftColor = v; } },
      'wc-border-w':       { fn: function(v) { var el = q('#preview-world-closing'); if(el) el.style.borderLeftWidth = v + 'px'; } },
      'wc-border-side':    { fn: function(v) { /* Would need to restructure border ‚Äî informational only */ } },
      'wc-font-style':     { fn: function(v) { var el = q('#preview-world-closing div'); if(el) el.style.fontStyle = v; } },
      'wc-em-weight':      { fn: function(v) { /* Emphasis weight ‚Äî applies to <em> if present */ } },
      'wc-em-color':       { fn: function(v) { /* Emphasis color ‚Äî applies to <em> if present */ } },
      'wc-text':           { fn: function(v) { var el = q('#preview-world-closing div'); if(el) el.textContent = v; } },

      // --- WORLD NETWORK: remaining targets that are harder to map ---
      'wn-caldera-color':  { fn: function(v) { /* Caldera not in simplified preview */ } },
      'wn-mycelium-color': { fn: function(v) { /* Mycelium not in simplified preview */ } },
      'wn-tidal-color':    { fn: function(v) { /* Tidal not in simplified preview */ } },
      'wn-loc-stroke':     { fn: function(v) { qa('#preview-world-network > div:nth-child(2) > div > div').forEach(function(n) { if(n.style.borderRadius === '50%' || n.style.borderWidth) n.style.borderWidth = v + 'px'; }); } },
      'wn-story-color':    { fn: function(v) { /* Story Events not in simplified preview */ } },
      'wn-proc-stroke':    { fn: function(v) { var n = q('#preview-world-network > div:nth-child(2) > div:nth-child(4) > div'); if(n) n.style.borderWidth = v + 'px'; } },
      'wn-pcg-color':      { fn: function(v) { /* PCG not in simplified preview */ } },
      'wn-ai-stroke':      { fn: function(v) { var n = q('#preview-world-network > div:nth-child(2) > div:nth-child(6) > div'); if(n) n.style.borderWidth = v + 'px'; } },
      'wn-output-radius':  { fn: function(v) { /* Output not in simplified preview */ } },
      'wn-output-stroke':  { fn: function(v) { /* Output not in simplified preview */ } },
      'wn-output-font':    { fn: function(v) { /* Output not in simplified preview */ } },
      'wn-line-w':         { fn: function(v) { /* Connection lines not rendered as DOM elements */ } },
      'wn-line-op':        { fn: function(v) { /* Connection lines not rendered as DOM elements */ } },
      'wn-dash-len':       { fn: function(v) { /* Connection lines not rendered as DOM elements */ } },
      'wn-dash-gap':       { fn: function(v) { /* Connection lines not rendered as DOM elements */ } },
      'wn-cross-w':        { fn: function(v) { /* Cross lines not rendered as DOM elements */ } },
      'wn-cross-op':       { fn: function(v) { /* Cross lines not rendered as DOM elements */ } },
      'wn-particle-r':     { fn: function(v) { /* Particles not rendered as DOM elements */ } },
      'wn-particle-op':    { fn: function(v) { /* Particles not rendered as DOM elements */ } },
      'wn-vert-color':     { fn: function(v) { /* Vertical lines not rendered as DOM elements */ } },

      // --- UNIVERSAL: ICON CIRCLES ---
      'icon-lg-size':      { fn: function(v) { qa('.p-icon-circle').forEach(function(el) { if(parseInt(el.style.width) >= 40) { el.style.width = v + 'px'; el.style.height = v + 'px'; } }); } },
      'icon-sm-size':      { fn: function(v) { qa('.p-icon-circle').forEach(function(el) { if(parseInt(el.style.width) < 40) { el.style.width = v + 'px'; el.style.height = v + 'px'; } }); } },
      'icon-font-lg':      { fn: function(v) { qa('.p-icon-circle').forEach(function(el) { el.style.fontSize = v + 'px'; }); } },
      'icon-bg-op':        { fn: function(v) { qa('.p-icon-circle').forEach(function(el) { el.style.opacity = v/100; }); } },

      // --- UNIVERSAL: COLOR PALETTE (update swatch backgrounds) ---
      'accent-blue':       { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[0]) sw[0].style.background = v; } },
      'accent-green':      { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[1]) sw[1].style.background = v; } },
      'accent-cyan':       { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[2]) sw[2].style.background = v; } },
      'accent-red':        { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[3]) sw[3].style.background = v; } },
      'accent-orange':     { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[4]) sw[4].style.background = v; } },
      'accent-purple':     { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[5]) sw[5].style.background = v; } },
      'bg-primary':        { fn: function(v) { var sw = qa('#preview-colors .p-color-swatch'); if(sw[6]) sw[6].style.background = v; } },
      'text-primary-opacity':   { fn: function(v) { var el = q('#preview-colors'); if(el) { var spans = el.querySelectorAll('.p-text-opacity'); if(spans[0]) spans[0].style.color = 'rgba(255,255,255,' + (v/100) + ')'; } } },
      'text-secondary-opacity': { fn: function(v) { var el = q('#preview-colors'); if(el) { var spans = el.querySelectorAll('.p-text-opacity'); if(spans[1]) spans[1].style.color = 'rgba(255,255,255,' + (v/100) + ')'; } } },
      'text-tertiary-opacity':  { fn: function(v) { var el = q('#preview-colors'); if(el) { var spans = el.querySelectorAll('.p-text-opacity'); if(spans[2]) spans[2].style.color = 'rgba(255,255,255,' + (v/100) + ')'; } } },

      // --- UNIVERSAL: BADGES (status badge colors) ---
      'status-progress-color': { fn: function(v) { qa('.p-status-progress').forEach(function(b) { b.style.background = v + '1a'; b.style.color = v; }); } },
      'status-specced-color':  { fn: function(v) { qa('.p-status-specced').forEach(function(b) { b.style.background = v + '1a'; b.style.color = v; }); } },

      // --- UNIVERSAL: LEGEND ---
      'live-color':        { fn: function(v) { qa('.p-live-dot').forEach(function(d) { d.style.background = v; d.style.boxShadow = '0 0 6px ' + v; }); } },
    };

    function triggerApply(target, value) {
      // 1. Check APPLY_MAP first (central mapping)
      var mapped = APPLY_MAP[target];
      if (mapped && mapped.fn) {
        mapped.fn(value);
        return;
      }
      // 2. Fall back to inline apply() on the PROPS definition
      if (!currentComp) return;
      var def = PROPS[currentComp];
      if (!def) return;
      def.groups.forEach(function(g) {
        g.props.forEach(function(p) {
          if (p.target === target && p.apply) {
            p.apply(value);
          }
        });
      });
    }

    // ============================================================
    // TOGGLE GROUP
    // ============================================================
    window.toggleGroup = function(header) {
      header.parentElement.classList.toggle('collapsed');
    };

    // ============================================================
    // TOOLBAR: BROWSER MODE
    // ============================================================
    window.setBrowser = function(mode) {
      qa('[data-mode]').forEach(function(b) { b.classList.toggle('active', b.getAttribute('data-mode') === mode); });
      document.getElementById('preview-canvas').classList.toggle('fallback-mode', mode === 'fallback');
    };

    // ============================================================
    // TOOLBAR: VIEWPORT
    // ============================================================
    window.setViewport = function(vp) {
      qa('[data-vp]').forEach(function(b) { b.classList.toggle('active', b.getAttribute('data-vp') === vp); });
      document.getElementById('preview-canvas').classList.toggle('mobile', vp === 'mobile');
    };

    // ============================================================
    // TOOLBAR: PAGE SELECT
    // ============================================================
    window.setPage = function(page) {
      currentPage = page;
      ['universal', 'home', 'spatial', 'compound', 'world'].forEach(function(p) {
        var el = document.getElementById('page-' + p);
        if (el) el.style.display = (p === page) ? 'block' : 'none';
      });
      // Deselect current component
      qa('.component-wrap').forEach(function(w) { w.classList.remove('selected'); });
      currentComp = null;
      document.getElementById('sidebar-content').innerHTML = '<div class="sidebar-empty" id="empty-state">Click any component<br>in the preview to inspect<br>and edit its properties</div>';
      document.getElementById('close-btn').style.display = 'none';
    };

    // ============================================================
    // SAVE & EXPORT
    // ============================================================
    window.exportConfig = function() {
      var config = { timestamp: new Date().toISOString(), components: {} };
      Object.keys(PROPS).forEach(function(compId) {
        config.components[compId] = { groups: [] };
        PROPS[compId].groups.forEach(function(group) {
          var gData = { title: group.title, badge: group.badge, props: {} };
          group.props.forEach(function(p) {
            var el = document.querySelector('[data-target="' + p.target + '"]');
            gData.props[p.target] = el ? (el.type === 'checkbox' ? el.checked : el.value) : p.value;
          });
          config.components[compId].groups.push(gData);
        });
      });
      var json = JSON.stringify(config, null, 2);
      var blob = new Blob([json], { type: 'application/json' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'meta-spatial-design-config.json';
      a.click();
      URL.revokeObjectURL(url);
      // Also save to localStorage
      localStorage.setItem('meta-spatial-ds-config', json);
      alert('Config exported! Share this JSON file to apply changes site-wide.');
    };

    // ============================================================
    // LOAD SAVED CONFIG
    // ============================================================
    var saved = localStorage.getItem('meta-spatial-ds-config');
    if (saved) {
      try {
        var cfg = JSON.parse(saved);
        if (cfg.components) {
          Object.keys(cfg.components).forEach(function(compId) {
            cfg.components[compId].groups.forEach(function(g) {
              Object.keys(g.props).forEach(function(target) {
                var el = document.querySelector('[data-target="' + target + '"]');
                if (el) el.value = g.props[target];
              });
            });
          });
        }
      } catch(e) { console.warn('Failed to load config', e); }
    }

  })();
  </script>
</body>
</html>
